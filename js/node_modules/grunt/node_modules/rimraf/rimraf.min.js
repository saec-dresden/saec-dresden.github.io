module.exports=rimraf;rimraf.sync=rimrafSync;var assert=require("assert");var path=require("path");var fs=require("fs");var timeout=0;exports.EMFILE_MAX=1000;exports.BUSYTRIES_MAX=3;var isWindows=(process.platform==="win32");function defaults(b){var a=["unlink","chmod","stat","rmdir","readdir"];a.forEach(function(c){b[c]=b[c]||fs[c];c=c+"Sync";b[c]=b[c]||fs[c]})}function rimraf(e,d,b){if(typeof d==="function"){b=d;d={}}assert(e);assert(d);assert(typeof b==="function");defaults(d);if(!b){throw new Error("No callback passed to rimraf()")}var a=0;rimraf_(e,d,function c(f){if(f){if(isWindows&&(f.code==="EBUSY"||f.code==="ENOTEMPTY")&&a<exports.BUSYTRIES_MAX){a++;var g=a*100;return setTimeout(function(){rimraf_(e,d,c)},g)}if(f.code==="EMFILE"&&timeout<exports.EMFILE_MAX){return setTimeout(function(){rimraf_(e,d,c)},timeout++)}if(f.code==="ENOENT"){f=null}}timeout=0;b(f)})}function rimraf_(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.unlink(c,function(d){if(d){if(d.code==="ENOENT"){return a(null)}if(d.code==="EPERM"){return(isWindows)?fixWinEPERM(c,b,d,a):rmdir(c,b,d,a)}if(d.code==="EISDIR"){return rmdir(c,b,d,a)}}return a(d)})}function fixWinEPERM(d,c,b,a){assert(d);assert(c);assert(typeof a==="function");if(b){assert(b instanceof Error)}c.chmod(d,666,function(e){if(e){a(e.code==="ENOENT"?null:b)}else{c.stat(d,function(f,g){if(f){a(f.code==="ENOENT"?null:b)}else{if(g.isDirectory()){rmdir(d,c,b,a)}else{c.unlink(d,a)}}})}})}function fixWinEPERMSync(e,d,a){assert(e);assert(d);if(a){assert(a instanceof Error)}try{d.chmodSync(e,666)}catch(b){if(b.code==="ENOENT"){return}else{throw a}}try{var f=d.statSync(e)}catch(c){if(c.code==="ENOENT"){return}else{throw a}}if(f.isDirectory()){rmdirSync(e,d,a)}else{d.unlinkSync(e)}}function rmdir(d,b,c,a){assert(d);assert(b);if(c){assert(c instanceof Error)}assert(typeof a==="function");b.rmdir(d,function(e){if(e&&(e.code==="ENOTEMPTY"||e.code==="EEXIST"||e.code==="EPERM")){rmkids(d,b,a)}else{if(e&&e.code==="ENOTDIR"){a(c)}else{a(e)}}})}function rmkids(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.readdir(c,function(d,f){if(d){return a(d)}var g=f.length;if(g===0){return b.rmdir(c,a)}var e;f.forEach(function(h){rimraf(path.join(c,h),b,function(i){if(e){return}if(i){return a(e=i)}if(--g===0){b.rmdir(c,a)}})})})}function rimrafSync(c,b){b=b||{};defaults(b);assert(c);assert(b);try{b.unlinkSync(c)}catch(a){if(a.code==="ENOENT"){return}if(a.code==="EPERM"){return isWindows?fixWinEPERMSync(c,b,a):rmdirSync(c,b,a)}if(a.code!=="EISDIR"){throw a}rmdirSync(c,b,a)}}function rmdirSync(d,b,c){assert(d);assert(b);if(c){assert(c instanceof Error)}try{b.rmdirSync(d)}catch(a){if(a.code==="ENOENT"){return}if(a.code==="ENOTDIR"){throw c}if(a.code==="ENOTEMPTY"||a.code==="EEXIST"||a.code==="EPERM"){rmkidsSync(d,b)}}}function rmkidsSync(b,a){assert(b);assert(a);a.readdirSync(b).forEach(function(c){rimrafSync(path.join(b,c),a)});a.rmdirSync(b,a)};