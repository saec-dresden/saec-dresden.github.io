(function(){var b,a,c,d,e,f,g,h,i,j,k,l,m;d=require("fs");j=require("path");e=require("./helpers");i=require("./optparse");b=require("./coffee-script");m={};h={};l=[];g=null;e.extend(global,{task:function(q,p,o){var n;if(!o){n=[p,o],o=n[0],p=n[1]}return m[q]={name:q,description:p,action:o}},option:function(p,o,n){return l.push([p,o,n])},invoke:function(n){if(!m[n]){f(n)}return m[n].action(h)}});exports.run=function(){var r,s,n,o,p,q;global.__originalDirname=d.realpathSync(".");process.chdir(a(__originalDirname));s=process.argv.slice(2);b.run(d.readFileSync("Cakefile").toString(),{filename:"Cakefile"});g=new i.OptionParser(l);if(!s.length){return k()}try{h=g.parse(s)}catch(t){return c(""+t)}p=h["arguments"];q=[];for(n=0,o=p.length;n<o;n++){r=p[n];q.push(invoke(r))}return q};k=function(){var n,o,p,q,r,s;q=j.relative||j.resolve;n=j.join(q(__originalDirname,process.cwd()),"Cakefile");console.log(""+n+" defines the following tasks:\n");for(p in m){s=m[p];r=20-p.length;r=r>0?Array(r+1).join(" "):"";o=s.description?"# "+s.description:"";console.log("cake "+p+r+" "+o)}if(l.length){return console.log(g.help())}};c=function(n){console.error(n+"\n");console.log('To see a list of all tasks/options, run "cake"');return process.exit(1)};f=function(n){return c("No such task: "+n)};a=function(n){var o;if(j.existsSync(j.join(n,"Cakefile"))){return n}o=j.normalize(j.join(n,".."));if(o!==n){return a(o)}throw new Error("Cakefile not found in "+(process.cwd()))}}).call(this);