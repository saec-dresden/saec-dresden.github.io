(function(){var f,g,h,i,j,k,l,m,n,o,s,u,w,x,y,C,z,A,B,E,F,G,H,I,J,K,M,O,P,Q,R,S,T,V,U,W,Y,ac,X,Z,aa,ad,ae,af,ag,ah,aj,al,am,an,p,q,r,t,v,D,L,N,ab,ai,ak,d,e,b={}.hasOwnProperty,a=function(ao,ar){for(var aq in ar){if(b.call(ar,aq)){ao[aq]=ar[aq]}}function ap(){this.constructor=ao}ap.prototype=ar.prototype;ao.prototype=new ap();ao.__super__=ar.prototype;return ao},c=[].indexOf||function(ap){for(var ao=0,aq=this.length;ao<aq;ao++){if(ao in this&&this[ao]===ap){return ao}}return -1};X=require("./scope").Scope;d=require("./lexer"),V=d.RESERVED,ac=d.STRICT_PROSCRIBED;e=require("./helpers"),p=e.compact,v=e.flatten,t=e.extend,L=e.merge,q=e.del,ab=e.starts,r=e.ends,D=e.last;exports.extend=t;an=function(){return true};P=function(){return false};af=function(){return this};O=function(){this.negated=!this.negated;return this};exports.Base=i=(function(){function ao(){}ao.prototype.compile=function(ar,ap){var aq;ar=t({},ar);if(ap){ar.level=ap}aq=this.unfoldSoak(ar)||this;aq.tab=ar.indent;if(ar.level===J||!aq.isStatement(ar)){return aq.compileNode(ar)}else{return aq.compileClosure(ar)}};ao.prototype.compileClosure=function(ap){if(this.jumps()){throw SyntaxError("cannot use a pure statement in an expression.")}ap.sharedScope=true;return m.wrap(this).compileNode(ap)};ao.prototype.cache=function(aq,ap,at){var ar,au;if(!this.isComplex()){ar=ap?this.compile(aq,ap):this;return[ar,ar]}else{ar=new K(at||aq.scope.freeVariable("ref"));au=new h(ar,this);if(ap){return[au.compile(aq,ap),ar.value]}else{return[au,ar]}}};ao.prototype.compileLoopReference=function(aq,ap){var ar,at;ar=at=this.compile(aq,G);if(!((-Infinity<+ar&&+ar<Infinity)||x.test(ar)&&aq.scope.check(ar,true))){ar=""+(at=aq.scope.freeVariable(ap))+" = "+ar}return[ar,at]};ao.prototype.makeReturn=function(aq){var ap;ap=this.unwrapAll();if(aq){return new k(new K(""+aq+".push"),[ap])}else{return new W(ap)}};ao.prototype.contains=function(aq){var ap;ap=false;this.traverseChildren(false,function(ar){if(aq(ar)){ap=true;return false}});return ap};ao.prototype.containsType=function(ap){return this instanceof ap||this.contains(function(aq){return aq instanceof ap})};ao.prototype.lastNonComment=function(aq){var ap;ap=aq.length;while(ap--){if(!(aq[ap] instanceof o)){return aq[ap]}}return null};ao.prototype.toString=function(ap,aq){var ar;if(ap==null){ap=""}if(aq==null){aq=this.constructor.name}ar="\n"+ap+aq;if(this.soak){ar+="?"}this.eachChild(function(at){return ar+=at.toString(ap+ae)});return ar};ao.prototype.eachChild=function(ay){var aw,ax,ap,aq,ar,at,au,av;if(!this.children){return this}au=this.children;for(ap=0,ar=au.length;ap<ar;ap++){aw=au[ap];if(this[aw]){av=v([this[aw]]);for(aq=0,at=av.length;aq<at;aq++){ax=av[aq];if(ay(ax)===false){return this}}}}return this};ao.prototype.traverseChildren=function(ap,aq){return this.eachChild(function(ar){if(aq(ar)===false){return false}return ar.traverseChildren(ap,aq)})};ao.prototype.invert=function(){return new R("!",this)};ao.prototype.unwrapAll=function(){var ap;ap=this;while(ap!==(ap=ap.unwrap())){continue}return ap};ao.prototype.children=[];ao.prototype.isStatement=P;ao.prototype.jumps=P;ao.prototype.isComplex=an;ao.prototype.isChainable=P;ao.prototype.isAssignable=P;ao.prototype.unwrap=af;ao.prototype.unfoldSoak=P;ao.prototype.assigns=P;return ao})();exports.Block=j=(function(ao){a(ap,ao);function ap(aq){this.expressions=p(v(aq||[]))}ap.prototype.children=["expressions"];ap.prototype.push=function(aq){this.expressions.push(aq);return this};ap.prototype.pop=function(){return this.expressions.pop()};ap.prototype.unshift=function(aq){this.expressions.unshift(aq);return this};ap.prototype.unwrap=function(){if(this.expressions.length===1){return this.expressions[0]}else{return this}};ap.prototype.isEmpty=function(){return !this.expressions.length};ap.prototype.isStatement=function(av){var au,aq,ar,at;at=this.expressions;for(aq=0,ar=at.length;aq<ar;aq++){au=at[aq];if(au.isStatement(av)){return true}}return false};ap.prototype.jumps=function(av){var au,aq,ar,at;at=this.expressions;for(aq=0,ar=at.length;aq<ar;aq++){au=at[aq];if(au.jumps(av)){return au}}};ap.prototype.makeReturn=function(at){var aq,ar;ar=this.expressions.length;while(ar--){aq=this.expressions[ar];if(!(aq instanceof o)){this.expressions[ar]=aq.makeReturn(at);if(aq instanceof W&&!aq.expression){this.expressions.splice(ar,1)}break}}return this};ap.prototype.compile=function(ar,aq){if(ar==null){ar={}}if(ar.scope){return ap.__super__.compile.call(this,ar,aq)}else{return this.compileRoot(ar)}};ap.prototype.compileNode=function(ax){var au,av,aw,ay,aq,ar,at;this.tab=ax.indent;ay=ax.level===J;av=[];at=this.expressions;for(aq=0,ar=at.length;aq<ar;aq++){aw=at[aq];aw=aw.unwrapAll();aw=aw.unfoldSoak(ax)||aw;if(aw instanceof ap){av.push(aw.compileNode(ax))}else{if(ay){aw.front=true;au=aw.compile(ax);if(!aw.isStatement(ax)){au=""+this.tab+au+";";if(aw instanceof K){au=""+au+"\n"}}av.push(au)}else{av.push(aw.compile(ax,G))}}}if(ay){if(this.spaced){return"\n"+(av.join("\n\n"))+"\n"}else{return av.join("\n")}}au=av.join(", ")||"void 0";if(av.length>1&&ax.level>=G){return"("+au+")"}else{return au}};ap.prototype.compileRoot=function(au){var aq,ar,at,av,aw,ax;au.indent=au.bare?"":ae;au.scope=new X(null,this,null);au.level=J;this.spaced=true;av="";if(!au.bare){aw=(function(){var ay,az,aA,aB;aA=this.expressions;aB=[];for(at=ay=0,az=aA.length;ay<az;at=++ay){ar=aA[at];if(!(ar.unwrap() instanceof o)){break}aB.push(ar)}return aB}).call(this);ax=this.expressions.slice(aw.length);this.expressions=aw;if(aw.length){av=""+(this.compileNode(L(au,{indent:""})))+"\n"}this.expressions=ax}aq=this.compileWithDeclarations(au);if(au.bare){return aq}return""+av+"(function() {\n"+aq+"\n}).call(this);\n"};ap.prototype.compileWithDeclarations=function(aB){var aw,ax,ay,az,aA,aC,aD,aE,aF,aq,ar,at,au,av;ax=aC="";at=this.expressions;for(aA=aq=0,ar=at.length;aq<ar;aA=++aq){az=at[aA];az=az.unwrap();if(!(az instanceof o||az instanceof K)){break}}aB=L(aB,{level:J});if(aA){aD=this.expressions.splice(aA,9000000000);au=[this.spaced,false],aF=au[0],this.spaced=au[1];av=[this.compileNode(aB),aF],ax=av[0],this.spaced=av[1];this.expressions=aD}aC=this.compileNode(aB);aE=aB.scope;if(aE.expressions===this){ay=aB.scope.hasDeclarations();aw=aE.hasAssignments;if(ay||aw){if(aA){ax+="\n"}ax+=""+this.tab+"var ";if(ay){ax+=aE.declaredVariables().join(", ")}if(aw){if(ay){ax+=",\n"+(this.tab+ae)}ax+=aE.assignedVariables().join(",\n"+(this.tab+ae))}ax+=";\n"}}return ax+aC};ap.wrap=function(aq){if(aq.length===1&&aq[0] instanceof ap){return aq[0]}return new ap(aq)};return ap})(i);exports.Literal=K=(function(ao){a(ap,ao);function ap(aq){this.value=aq}ap.prototype.makeReturn=function(){if(this.isStatement()){return this}else{return ap.__super__.makeReturn.apply(this,arguments)}};ap.prototype.isAssignable=function(){return x.test(this.value)};ap.prototype.isStatement=function(){var aq;return(aq=this.value)==="break"||aq==="continue"||aq==="debugger"};ap.prototype.isComplex=P;ap.prototype.assigns=function(aq){return aq===this.value};ap.prototype.jumps=function(aq){if(this.value==="break"&&!((aq!=null?aq.loop:void 0)||(aq!=null?aq.block:void 0))){return this}if(this.value==="continue"&&!(aq!=null?aq.loop:void 0)){return this}};ap.prototype.compileNode=function(at){var ar,aq;ar=this.value==="this"?((aq=at.scope.method)!=null?aq.bound:void 0)?at.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value;if(this.isStatement()){return""+this.tab+ar+";"}else{return ar}};ap.prototype.toString=function(){return' "'+this.value+'"'};return ap})(i);exports.Undefined=(function(ao){a(ap,ao);function ap(){return ap.__super__.constructor.apply(this,arguments)}ap.prototype.isAssignable=P;ap.prototype.isComplex=P;ap.prototype.compileNode=function(aq){if(aq.level>=E){return"(void 0)"}else{return"void 0"}};return ap})(i);exports.Null=(function(ao){a(ap,ao);function ap(){return ap.__super__.constructor.apply(this,arguments)}ap.prototype.isAssignable=P;ap.prototype.isComplex=P;ap.prototype.compileNode=function(){return"null"};return ap})(i);exports.Bool=(function(ao){a(ap,ao);ap.prototype.isAssignable=P;ap.prototype.isComplex=P;ap.prototype.compileNode=function(){return this.val};function ap(aq){this.val=aq}return ap})(i);exports.Return=W=(function(ao){a(ap,ao);function ap(aq){if(aq&&!aq.unwrap().isUndefined){this.expression=aq}}ap.prototype.children=["expression"];ap.prototype.isStatement=an;ap.prototype.makeReturn=af;ap.prototype.jumps=af;ap.prototype.compile=function(au,at){var ar,aq;ar=(aq=this.expression)!=null?aq.makeReturn():void 0;if(ar&&!(ar instanceof ap)){return ar.compile(au,at)}else{return ap.__super__.compile.call(this,au,at)}};ap.prototype.compileNode=function(aq){return this.tab+("return"+[this.expression?" "+(this.expression.compile(aq,I)):void 0]+";")};return ap})(i);exports.Value=al=(function(ao){a(ap,ao);function ap(aq,ar,at){if(!ar&&aq instanceof ap){return aq}this.base=aq;this.properties=ar||[];if(at){this[at]=true}return this}ap.prototype.children=["base","properties"];ap.prototype.add=function(aq){this.properties=this.properties.concat(aq);return this};ap.prototype.hasProperties=function(){return !!this.properties.length};ap.prototype.isArray=function(){return !this.properties.length&&this.base instanceof g};ap.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()};ap.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()};ap.prototype.isSimpleNumber=function(){return this.base instanceof K&&Y.test(this.base.value)};ap.prototype.isString=function(){return this.base instanceof K&&C.test(this.base.value)};ap.prototype.isAtomic=function(){var au,aq,ar,at;at=this.properties.concat(this.base);for(aq=0,ar=at.length;aq<ar;aq++){au=at[aq];if(au.soak||au instanceof k){return false}}return true};ap.prototype.isStatement=function(aq){return !this.properties.length&&this.base.isStatement(aq)};ap.prototype.assigns=function(aq){return !this.properties.length&&this.base.assigns(aq)};ap.prototype.jumps=function(aq){return !this.properties.length&&this.base.jumps(aq)};ap.prototype.isObject=function(aq){if(this.properties.length){return false}return(this.base instanceof Q)&&(!aq||this.base.generated)};ap.prototype.isSplice=function(){return D(this.properties) instanceof Z};ap.prototype.unwrap=function(){if(this.properties.length){return this}else{return this.base}};ap.prototype.cacheReference=function(av){var aq,ar,at,au;at=D(this.properties);if(this.properties.length<2&&!this.base.isComplex()&&!(at!=null?at.isComplex():void 0)){return[this,this]}aq=new ap(this.base,this.properties.slice(0,-1));if(aq.isComplex()){ar=new K(av.scope.freeVariable("base"));aq=new ap(new T(new h(ar,aq)))}if(!at){return[aq,ar]}if(at.isComplex()){au=new K(av.scope.freeVariable("name"));at=new B(new h(au,at.index));au=new B(au)}return[aq.add(at),new ap(ar||aq.base,[au||at])]};ap.prototype.compileNode=function(au){var at,av,aw,aq,ar;this.base.front=this.front;aw=this.properties;at=this.base.compile(au,aw.length?E:null);if((this.base instanceof T||aw.length)&&Y.test(at)){at=""+at+"."}for(aq=0,ar=aw.length;aq<ar;aq++){av=aw[aq];at+=av.compile(au)}return at};ap.prototype.unfoldSoak=function(ar){var at,aq=this;if(this.unfoldedSoak!=null){return this.unfoldedSoak}at=(function(){var ax,ay,az,aA,aB,aC,au,av,aw;if(az=aq.base.unfoldSoak(ar)){Array.prototype.push.apply(az.body.properties,aq.properties);return az}aw=aq.properties;for(ay=au=0,av=aw.length;au<av;ay=++au){aA=aw[ay];if(!aA.soak){continue}aA.soak=false;ax=new ap(aq.base,aq.properties.slice(0,ay));aC=new ap(aq.base,aq.properties.slice(ay));if(ax.isComplex()){aB=new K(ar.scope.freeVariable("ref"));ax=new T(new h(aB,ax));aC.base=aB}return new z(new s(ax),aC,{soak:true})}return null})();return this.unfoldedSoak=at||false};return ap})(i);exports.Comment=o=(function(ao){a(ap,ao);function ap(aq){this.comment=aq}ap.prototype.isStatement=an;ap.prototype.makeReturn=af;ap.prototype.compileNode=function(at,ar){var aq;aq="/*"+N(this.comment,this.tab)+("\n"+this.tab+"*/\n");if((ar||at.level)===J){aq=at.indent+aq}return aq};return ap})(i);exports.Call=k=(function(ao){a(ap,ao);function ap(at,aq,ar){this.args=aq!=null?aq:[];this.soak=ar;this.isNew=false;this.isSuper=at==="super";this.variable=this.isSuper?null:at}ap.prototype.children=["variable","args"];ap.prototype.newInstance=function(){var ar,aq;ar=((aq=this.variable)!=null?aq.base:void 0)||this.variable;if(ar instanceof ap&&!ar.isNew){ar.newInstance()}else{this.isNew=true}return this};ap.prototype.superReference=function(au){var aq,ar,at;ar=au.scope.namedMethod();if(!ar){throw SyntaxError("cannot call super outside of a function.")}at=ar.name;if(at==null){throw SyntaxError("cannot call super on an anonymous function.")}if(ar.klass){aq=[new f(new K("__super__"))];if(ar["static"]){aq.push(new f(new K("constructor")))}aq.push(new f(new K(at)));return(new al(new K(ar.klass),aq)).compile(au)}else{return""+at+".__super__.constructor"}};ap.prototype.superThis=function(ar){var aq;aq=ar.scope.method;return(aq&&!aq.klass&&aq.context)||"this"};ap.prototype.unfoldSoak=function(az){var av,aw,ax,ay,aA,aq,ar,at,au;if(this.soak){if(this.variable){if(aw=ai(az,this,"variable")){return aw}at=new al(this.variable).cacheReference(az),ax=at[0],aA=at[1]}else{ax=new K(this.superReference(az));aA=new al(ax)}aA=new ap(aA,this.args);aA.isNew=this.isNew;ax=new K("typeof "+(ax.compile(az))+' === "function"');return new z(ax,new al(aA),{soak:true})}av=this;ay=[];while(true){if(av.variable instanceof ap){ay.push(av);av=av.variable;continue}if(!(av.variable instanceof al)){break}ay.push(av);if(!((av=av.variable.base) instanceof ap)){break}}au=ay.reverse();for(aq=0,ar=au.length;aq<ar;aq++){av=au[aq];if(aw){if(av.variable instanceof ap){av.variable=aw}else{av.variable.base=aw}}aw=ai(az,av,"variable")}return aw};ap.prototype.filterImplicitObjects=function(aw){var ax,ay,az,aA,aB,aq,ar,at,au,av;ay=[];for(aq=0,at=aw.length;aq<at;aq++){ax=aw[aq];if(!((typeof ax.isObject==="function"?ax.isObject():void 0)&&ax.base.generated)){ay.push(ax);continue}az=null;av=ax.base.properties;for(ar=0,au=av.length;ar<au;ar++){aA=av[ar];if(aA instanceof h||aA instanceof o){if(!az){ay.push(az=new Q(aB=[],true))}aB.push(aA)}else{ay.push(aA);az=null}}}return ay};ap.prototype.compileNode=function(av){var ar,at,au,aq;if((aq=this.variable)!=null){aq.front=this.front}if(au=aa.compileSplattedArray(av,this.args,true)){return this.compileSplat(av,au)}at=this.filterImplicitObjects(this.args);at=((function(){var aw,ax,ay;ay=[];for(aw=0,ax=at.length;aw<ax;aw++){ar=at[aw];ay.push(ar.compile(av,G))}return ay})()).join(", ");if(this.isSuper){return this.superReference(av)+(".call("+(this.superThis(av))+(at&&", "+at)+")")}else{return(this.isNew?"new ":"")+this.variable.compile(av,E)+("("+at+")")}};ap.prototype.compileSuper=function(aq,ar){return""+(this.superReference(ar))+".call("+(this.superThis(ar))+(aq.length?", ":"")+aq+")"};ap.prototype.compileSplat=function(av,ax){var aq,ar,at,au,aw;if(this.isSuper){return""+(this.superReference(av))+".apply("+(this.superThis(av))+", "+ax+")"}if(this.isNew){at=this.tab+ae;return"(function(func, args, ctor) {\n"+at+"ctor.prototype = func.prototype;\n"+at+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+at+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+(this.variable.compile(av,G))+", "+ax+", function(){})"}aq=new al(this.variable);if((au=aq.properties.pop())&&aq.isComplex()){aw=av.scope.freeVariable("ref");ar="("+aw+" = "+(aq.compile(av,G))+")"+(au.compile(av))}else{ar=aq.compile(av,E);if(Y.test(ar)){ar="("+ar+")"}if(au){aw=ar;ar+=au.compile(av)}else{aw="null"}}return""+ar+".apply("+aw+", "+ax+")"};return ap})(i);exports.Extends=u=(function(ao){a(ap,ao);function ap(aq,ar){this.child=aq;this.parent=ar}ap.prototype.children=["child","parent"];ap.prototype.compile=function(aq){return new k(new al(new K(ak("extends"))),[this.child,this.parent]).compile(aq)};return ap})(i);exports.Access=f=(function(ao){a(ap,ao);function ap(aq,ar){this.name=aq;this.name.asKey=true;this.soak=ar==="soak"}ap.prototype.children=["name"];ap.prototype.compile=function(ar){var aq;aq=this.name.compile(ar);if(x.test(aq)){return"."+aq}else{return"["+aq+"]"}};ap.prototype.isComplex=P;return ap})(i);exports.Index=B=(function(ao){a(ap,ao);function ap(aq){this.index=aq}ap.prototype.children=["index"];ap.prototype.compile=function(aq){return"["+(this.index.compile(aq,I))+"]"};ap.prototype.isComplex=function(){return this.index.isComplex()};return ap})(i);exports.Range=U=(function(ao){a(ap,ao);ap.prototype.children=["from","to"];function ap(aq,at,ar){this.from=aq;this.to=at;this.exclusive=ar==="exclusive";this.equals=this.exclusive?"":"="}ap.prototype.compileVariables=function(av){var aw,aq,ar,at,au;av=L(av,{top:true});aq=this.from.cache(av,G),this.fromC=aq[0],this.fromVar=aq[1];ar=this.to.cache(av,G),this.toC=ar[0],this.toVar=ar[1];if(aw=q(av,"step")){at=aw.cache(av,G),this.step=at[0],this.stepVar=at[1]}au=[this.fromVar.match(Y),this.toVar.match(Y)],this.fromNum=au[0],this.toNum=au[1];if(this.stepVar){return this.stepNum=this.stepVar.match(Y)}};ap.prototype.compileNode=function(aC){var at,au,av,aw,ax,ay,az,aA,aB,aD,aE,aF,aq,ar;if(!this.fromVar){this.compileVariables(aC)}if(!aC.index){return this.compileArray(aC)}az=this.fromNum&&this.toNum;ax=q(aC,"index");ay=q(aC,"name");aB=ay&&ay!==ax;aF=""+ax+" = "+this.fromC;if(this.toC!==this.toVar){aF+=", "+this.toC}if(this.step!==this.stepVar){aF+=", "+this.step}aq=[""+ax+" <"+this.equals,""+ax+" >"+this.equals],aA=aq[0],aw=aq[1];au=this.stepNum?+this.stepNum>0?""+aA+" "+this.toVar:""+aw+" "+this.toVar:az?((ar=[+this.fromNum,+this.toNum],av=ar[0],aE=ar[1],ar),av<=aE?""+aA+" "+aE:""+aw+" "+aE):(at=""+this.fromVar+" <= "+this.toVar,""+at+" ? "+aA+" "+this.toVar+" : "+aw+" "+this.toVar);aD=this.stepVar?""+ax+" += "+this.stepVar:az?aB?av<=aE?"++"+ax:"--"+ax:av<=aE?""+ax+"++":""+ax+"--":aB?""+at+" ? ++"+ax+" : --"+ax:""+at+" ? "+ax+"++ : "+ax+"--";if(aB){aF=""+ay+" = "+aF}if(aB){aD=""+ay+" = "+aD}return""+aF+"; "+au+"; "+aD};ap.prototype.compileArray=function(aB){var av,aw,ax,ay,az,aA,aC,aD,aE,aF,aG,aq,ar,at,au;if(this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20){aE=(function(){au=[];for(var aH=ar=+this.fromNum,aI=+this.toNum;ar<=aI?aH<=aI:aH>=aI;ar<=aI?aH++:aH--){au.push(aH)}return au}).apply(this);if(this.exclusive){aE.pop()}return"["+(aE.join(", "))+"]"}aA=this.tab+ae;az=aB.scope.freeVariable("i");aF=aB.scope.freeVariable("results");aD="\n"+aA+aF+" = [];";if(this.fromNum&&this.toNum){aB.index=az;aw=this.compileNode(aB)}else{aG=(""+az+" = "+this.fromC)+(this.toC!==this.toVar?", "+this.toC:"");ax=""+this.fromVar+" <= "+this.toVar;aw="var "+aG+"; "+ax+" ? "+az+" <"+this.equals+" "+this.toVar+" : "+az+" >"+this.equals+" "+this.toVar+"; "+ax+" ? "+az+"++ : "+az+"--"}aC="{ "+aF+".push("+az+"); }\n"+aA+"return "+aF+";\n"+aB.indent;ay=function(aH){return aH!=null?aH.contains(function(aI){return aI instanceof K&&aI.value==="arguments"&&!aI.asKey}):void 0};if(ay(this.from)||ay(this.to)){av=", arguments"}return"(function() {"+aD+"\n"+aA+"for ("+aw+")"+aC+"}).apply(this"+(av!=null?av:"")+")"};return ap})(i);exports.Slice=Z=(function(ao){a(ap,ao);ap.prototype.children=["range"];function ap(aq){this.range=aq;ap.__super__.constructor.call(this)}ap.prototype.compileNode=function(av){var ar,at,au,aw,ax,aq;aq=this.range,aw=aq.to,at=aq.from;au=at&&at.compile(av,I)||"0";ar=aw&&aw.compile(av,I);if(aw&&!(!this.range.exclusive&&+ar===-1)){ax=", "+(this.range.exclusive?ar:Y.test(ar)?""+(+ar+1):(ar=aw.compile(av,E),""+ar+" + 1 || 9e9"))}return".slice("+au+(ax||"")+")"};return ap})(i);exports.Obj=Q=(function(ao){a(ap,ao);function ap(ar,aq){this.generated=aq!=null?aq:false;this.objects=this.properties=ar||[]}ap.prototype.children=["properties"];ap.prototype.compileNode=function(aC){var aw,ax,ay,az,aA,aB,aD,aE,aF,aG,aH,aq,ar,at,au,av;aH=this.properties;aG=[];av=this.properties;for(aq=0,at=av.length;aq<at;aq++){aE=av[aq];if(aE.isComplex()){aE=aE.variable}if(aE!=null){aF=aE.unwrapAll().value.toString();if(c.call(aG,aF)>=0){throw SyntaxError('multiple object literal properties named "'+aF+'"')}aG.push(aF)}}if(!aH.length){return(this.front?"({})":"{}")}if(this.generated){for(ar=0,au=aH.length;ar<au;ar++){aB=aH[ar];if(aB instanceof al){throw new Error("cannot have an implicit value in an implicit object")}}}ax=aC.indent+=ae;aA=this.lastNonComment(this.properties);aH=(function(){var aI,aJ,aK;aK=[];for(aw=aI=0,aJ=aH.length;aI<aJ;aw=++aI){aE=aH[aw];az=aw===aH.length-1?"":aE===aA||aE instanceof o?"\n":",\n";ay=aE instanceof o?"":ax;if(aE instanceof al&&aE["this"]){aE=new h(aE.properties[0].name,aE,"object")}if(!(aE instanceof o)){if(!(aE instanceof h)){aE=new h(aE,aE,"object")}(aE.variable.base||aE.variable).asKey=true}aK.push(ay+aE.compile(aC,J)+az)}return aK})();aH=aH.join("");aD="{"+(aH&&"\n"+aH+"\n"+this.tab)+"}";if(this.front){return"("+aD+")"}else{return aD}};ap.prototype.assigns=function(au){var av,aq,ar,at;at=this.properties;for(aq=0,ar=at.length;aq<ar;aq++){av=at[aq];if(av.assigns(au)){return true}}return false};return ap})(i);exports.Arr=g=(function(ao){a(ap,ao);function ap(aq){this.objects=aq||[]}ap.prototype.children=["objects"];ap.prototype.filterImplicitObjects=k.prototype.filterImplicitObjects;ap.prototype.compileNode=function(ar){var aq,at,au;if(!this.objects.length){return"[]"}ar.indent+=ae;au=this.filterImplicitObjects(this.objects);if(aq=aa.compileSplattedArray(ar,au)){return aq}aq=((function(){var av,aw,ax;ax=[];for(av=0,aw=au.length;av<aw;av++){at=au[av];ax.push(at.compile(ar,G))}return ax})()).join(", ");if(aq.indexOf("\n")>=0){return"[\n"+ar.indent+aq+"\n"+this.tab+"]"}else{return"["+aq+"]"}};ap.prototype.assigns=function(au){var av,aq,ar,at;at=this.objects;for(aq=0,ar=at.length;aq<ar;aq++){av=at[aq];if(av.assigns(au)){return true}}return false};return ap})(i);exports.Class=l=(function(ao){a(ap,ao);function ap(at,ar,aq){this.variable=at;this.parent=ar;this.body=aq!=null?aq:new j;this.boundFuncs=[];this.body.classBody=true}ap.prototype.children=["variable","parent","body"];ap.prototype.determineName=function(){var aq,ar;if(!this.variable){return null}aq=(ar=D(this.variable.properties))?ar instanceof f&&ar.name.value:this.variable.base.value;if(c.call(ac,aq)>=0){throw SyntaxError("variable name may not be "+aq)}return aq&&(aq=x.test(aq)&&aq)};ap.prototype.setContext=function(aq){return this.body.traverseChildren(false,function(ar){if(ar.classBody){return false}if(ar instanceof K&&ar.value==="this"){return ar.value=aq}else{if(ar instanceof n){ar.klass=aq;if(ar.bound){return ar.context=aq}}}})};ap.prototype.addBoundFunctions=function(ax){var av,aw,aq,ar,at,au;if(this.boundFuncs.length){at=this.boundFuncs;au=[];for(aq=0,ar=at.length;aq<ar;aq++){av=at[aq];aw=(new al(new K("this"),[new f(av)])).compile(ax);au.push(this.ctor.body.unshift(new K(""+aw+" = "+(ak("bind"))+"("+aw+", this)")))}return au}};ap.prototype.addProperties=function(aw,av,ax){var aq,ar,at,au,ay;ay=aw.base.properties.slice(0);at=(function(){var az;az=[];while(aq=ay.shift()){if(aq instanceof h){ar=aq.variable.base;delete aq.context;au=aq.value;if(ar.value==="constructor"){if(this.ctor){throw new Error("cannot define more than one constructor in a class")}if(au.bound){throw new Error("cannot define a constructor as a bound function")}if(au instanceof n){aq=this.ctor=au}else{this.externalCtor=ax.scope.freeVariable("class");aq=new h(new K(this.externalCtor),au)}}else{if(aq.variable["this"]){au["static"]=true;if(au.bound){au.context=av}}else{aq.variable=new al(new K(av),[new f(new K("prototype")),new f(ar)]);if(au instanceof n&&au.bound){this.boundFuncs.push(ar);au.bound=false}}}}az.push(aq)}return az}).call(this);return p(at)};ap.prototype.walkBody=function(ar,at){var aq=this;return this.traverseChildren(false,function(ax){var ay,az,aA,au,av,aw;if(ax instanceof ap){return false}if(ax instanceof j){aw=ay=ax.expressions;for(az=au=0,av=aw.length;au<av;az=++au){aA=aw[az];if(aA instanceof al&&aA.isObject(true)){ay[az]=aq.addProperties(aA,ar,at)}}return ax.expressions=ay=v(ay)}})};ap.prototype.hoistDirectivePrologue=function(){var aq,ar,at;ar=0;aq=this.body.expressions;while((at=aq[ar])&&at instanceof o||at instanceof al&&at.isString()){++ar}return this.directives=aq.splice(0,ar)};ap.prototype.ensureConstructor=function(aq){if(!this.ctor){this.ctor=new n;if(this.parent){this.ctor.body.push(new K(""+aq+".__super__.constructor.apply(this, arguments)"))}if(this.externalCtor){this.ctor.body.push(new K(""+this.externalCtor+".apply(this, arguments)"))}this.ctor.body.makeReturn();this.body.expressions.unshift(this.ctor)}this.ctor.ctor=this.ctor.name=aq;this.ctor.klass=null;return this.ctor.noReturn=true};ap.prototype.compileNode=function(ax){var ar,at,au,av,aw,ay,aq;at=this.determineName();aw=at||"_Class";if(aw.reserved){aw="_"+aw}av=new K(aw);this.hoistDirectivePrologue();this.setContext(aw);this.walkBody(aw,ax);this.ensureConstructor(aw);this.body.spaced=true;if(!(this.ctor instanceof n)){this.body.expressions.unshift(this.ctor)}this.body.expressions.push(av);(aq=this.body.expressions).unshift.apply(aq,this.directives);this.addBoundFunctions(ax);ar=m.wrap(this.body);if(this.parent){this.superClass=new K(ax.scope.freeVariable("super",false));this.body.expressions.unshift(new u(av,this.superClass));ar.args.push(this.parent);ay=ar.variable.params||ar.variable.base.params;ay.push(new S(this.superClass))}au=new T(ar,true);if(this.variable){au=new h(this.variable,au)}return au.compile(ax)};return ap})(i);exports.Assign=h=(function(ao){a(ap,ao);function ap(ax,aw,ar,av){var at,au,aq;this.variable=ax;this.value=aw;this.context=ar;this.param=av&&av.param;this.subpattern=av&&av.subpattern;at=(aq=(au=this.variable.unwrapAll().value),c.call(ac,aq)>=0);if(at&&this.context!=="object"){throw SyntaxError('variable name may not be "'+au+'"')}}ap.prototype.children=["variable","value"];ap.prototype.isStatement=function(aq){return(aq!=null?aq.level:void 0)===J&&(this.context!=null)&&c.call(this.context,"?")>=0};ap.prototype.assigns=function(aq){return this[this.context==="object"?"value":"variable"].assigns(aq)};ap.prototype.unfoldSoak=function(aq){return ai(aq,this,"variable")};ap.prototype.compileNode=function(ay){var av,aw,ax,az,aA,aq,ar,at,au;if(av=this.variable instanceof al){if(this.variable.isArray()||this.variable.isObject()){return this.compilePatternMatch(ay)}if(this.variable.isSplice()){return this.compileSplice(ay)}if((aq=this.context)==="||="||aq==="&&="||aq==="?="){return this.compileConditional(ay)}}ax=this.variable.compile(ay,G);if(!this.context){if(!(aA=this.variable.unwrapAll()).isAssignable()){throw SyntaxError('"'+(this.variable.compile(ay))+'" cannot be assigned.')}if(!(typeof aA.hasProperties==="function"?aA.hasProperties():void 0)){if(this.param){ay.scope.add(ax,"var")}else{ay.scope.find(ax)}}}if(this.value instanceof n&&(aw=M.exec(ax))){if(aw[1]){this.value.klass=aw[1]}this.value.name=(ar=(at=(au=aw[2])!=null?au:aw[3])!=null?at:aw[4])!=null?ar:aw[5]}az=this.value.compile(ay,G);if(this.context==="object"){return""+ax+": "+az}az=ax+(" "+(this.context||"=")+" ")+az;if(ay.level<=G){return az}else{return"("+az+")"}};ap.prototype.compilePatternMatch=function(aI){var aA,aB,aC,aD,aE,aF,aG,aH,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aq,ar,at,au,av,aw,ax,ay,az;aP=aI.level===J;aR=this.value;aK=this.variable.base.objects;if(!(aL=aK.length)){aC=aR.compile(aI);if(aI.level>=H){return"("+aC+")"}else{return aC}}aF=this.variable.isObject();if(aP&&aL===1&&!((aJ=aK[0]) instanceof aa)){if(aJ instanceof ap){at=aJ,(au=at.variable,aE=au.base),aJ=at.value}else{if(aJ.base instanceof T){av=new al(aJ.unwrapAll()).cacheReference(aI),aJ=av[0],aE=av[1]}else{aE=aF?aJ["this"]?aJ.properties[0].name:aJ:new K(0)}}aA=x.test(aE.unwrap().value||0);aR=new al(aR);aR.properties.push(new (aA?f:B)(aE));if(aw=aJ.unwrap().value,c.call(V,aw)>=0){throw new SyntaxError("assignment to a reserved word: "+(aJ.compile(aI))+" = "+(aR.compile(aI)))}return new ap(aJ,aR,null,{param:this.param}).compile(aI,J)}aS=aR.compile(aI,G);aB=[];aO=false;if(!x.test(aS)||this.variable.assigns(aS)){aB.push(""+(aM=aI.scope.freeVariable("ref"))+" = "+aS);aS=aM}for(aD=aq=0,ar=aK.length;aq<ar;aD=++aq){aJ=aK[aD];aE=aD;if(aF){if(aJ instanceof ap){ax=aJ,(ay=ax.variable,aE=ay.base),aJ=ax.value}else{if(aJ.base instanceof T){az=new al(aJ.unwrapAll()).cacheReference(aI),aJ=az[0],aE=az[1]}else{aE=aJ["this"]?aJ.properties[0].name:aJ}}}if(!aO&&aJ instanceof aa){aH=aJ.name.unwrap().value;aJ=aJ.unwrap();aQ=""+aL+" <= "+aS+".length ? "+(ak("slice"))+".call("+aS+", "+aD;if(aN=aL-aD-1){aG=aI.scope.freeVariable("i");aQ+=", "+aG+" = "+aS+".length - "+aN+") : ("+aG+" = "+aD+", [])"}else{aQ+=") : []"}aQ=new K(aQ);aO=""+aG+"++"}else{aH=aJ.unwrap().value;if(aJ instanceof aa){aJ=aJ.name.compile(aI);throw new SyntaxError("multiple splats are disallowed in an assignment: "+aJ+"...")}if(typeof aE==="number"){aE=new K(aO||aE);aA=false}else{aA=aF&&x.test(aE.unwrap().value||0)}aQ=new al(new K(aS),[new (aA?f:B)(aE)])}if((aH!=null)&&c.call(V,aH)>=0){throw new SyntaxError("assignment to a reserved word: "+(aJ.compile(aI))+" = "+(aQ.compile(aI)))}aB.push(new ap(aJ,aQ,null,{param:this.param,subpattern:true}).compile(aI,G))}if(!(aP||this.subpattern)){aB.push(aS)}aC=aB.join(", ");if(aI.level<G){return aC}else{return"("+aC+")"}};ap.prototype.compileConditional=function(at){var ar,au,aq;aq=this.variable.cacheReference(at),ar=aq[0],au=aq[1];if(!ar.properties.length&&ar.base instanceof K&&ar.base.value!=="this"&&!at.scope.check(ar.base.value)){throw new Error('the variable "'+ar.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.")}if(c.call(this.context,"?")>=0){at.isExistentialEquals=true}return new R(this.context.slice(0,-1),ar,new ap(au,this.value,"=")).compile(at)};ap.prototype.compileSplice=function(aA){var au,av,aw,ax,ay,az,aB,aC,aD,aq,ar,at;aq=this.variable.properties.pop().range,aw=aq.from,aB=aq.to,av=aq.exclusive;az=this.variable.compile(aA);ar=(aw!=null?aw.cache(aA,H):void 0)||["0","0"],ax=ar[0],ay=ar[1];if(aB){if((aw!=null?aw.isSimpleNumber():void 0)&&aB.isSimpleNumber()){aB=+aB.compile(aA)-+ay;if(!av){aB+=1}}else{aB=aB.compile(aA,E)+" - "+ay;if(!av){aB+=" + 1"}}}else{aB="9e9"}at=this.value.cache(aA,G),aC=at[0],aD=at[1];au="[].splice.apply("+az+", ["+ax+", "+aB+"].concat("+aC+")), "+aD;if(aA.level>J){return"("+au+")"}else{return au}};return ap})(i);exports.Code=n=(function(ao){a(ap,ao);function ap(ar,aq,at){this.params=ar||[];this.body=aq||new j;this.bound=at==="boundfunc";if(this.bound){this.context="_this"}}ap.prototype.children=["params","body"];ap.prototype.isStatement=function(){return !!this.ctor};ap.prototype.jumps=P;ap.prototype.compileNode=function(aQ){var aK,aL,aM,aN,aO,aP,aR,aS,aT,aU,aV,aW,aX,aY,aq,ar,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ;aQ.scope=new X(aQ.scope,this.body,this);aQ.scope.shared=q(aQ,"sharedScope");aQ.indent+=ae;delete aQ.bare;delete aQ.isExistentialEquals;aT=[];aL=[];aD=this.paramNames();for(aq=0,av=aD.length;aq<av;aq++){aP=aD[aq];if(!aQ.scope.check(aP)){aQ.scope.parameter(aP)}}aE=this.params;for(ar=0,aw=aE.length;ar<aw;ar++){aS=aE[ar];if(!aS.splat){continue}aF=this.params;for(at=0,ax=aF.length;at<ax;at++){aR=aF[at].name;if(aR["this"]){aR=aR.properties[0].name}if(aR.value){aQ.scope.add(aR.value,"var",true)}}aV=new h(new al(new g((function(){var aZ,a0,a1,a2;a1=this.params;a2=[];for(aZ=0,a0=a1.length;aZ<a0;aZ++){aR=a1[aZ];a2.push(aR.asReference(aQ))}return a2}).call(this))),new al(new K("arguments")));break}aG=this.params;for(au=0,ay=aG.length;au<ay;au++){aS=aG[au];if(aS.isComplex()){aX=aU=aS.asReference(aQ);if(aS.value){aX=new R("?",aU,aS.value)}aL.push(new h(new al(aS.name),aX,"=",{param:true}))}else{aU=aS;if(aS.value){aO=new K(aU.name.value+" == null");aX=new h(new al(aS.name),aS.value,"=");aL.push(new z(aO,aX))}}if(!aV){aT.push(aU)}}aY=this.body.isEmpty();if(aV){aL.unshift(aV)}if(aL.length){(aH=this.body.expressions).unshift.apply(aH,aL)}for(aM=aB=0,az=aT.length;aB<az;aM=++aB){aR=aT[aM];aQ.scope.parameter(aT[aM]=aR.compile(aQ))}aW=[];aI=this.paramNames();for(aC=0,aA=aI.length;aC<aA;aC++){aP=aI[aC];if(c.call(aW,aP)>=0){throw SyntaxError("multiple parameters named '"+aP+"'")}aW.push(aP)}if(!(aY||this.noReturn)){this.body.makeReturn()}if(this.bound){if((aJ=aQ.scope.parent.method)!=null?aJ.bound:void 0){this.bound=this.context=aQ.scope.parent.method.context}else{if(!this["static"]){aQ.scope.parent.assign("_this","this")}}}aN=aQ.indent;aK="function";if(this.ctor){aK+=" "+this.name}aK+="("+aT.join(", ")+") {";if(!this.body.isEmpty()){aK+="\n"+(this.body.compileWithDeclarations(aQ))+"\n"+this.tab}aK+="}";if(this.ctor){return this.tab+aK}if(this.front||(aQ.level>=E)){return"("+aK+")"}else{return aK}};ap.prototype.paramNames=function(){var au,av,aq,ar,at;au=[];at=this.params;for(aq=0,ar=at.length;aq<ar;aq++){av=at[aq];au.push.apply(au,av.names())}return au};ap.prototype.traverseChildren=function(aq,ar){if(aq){return ap.__super__.traverseChildren.call(this,aq,ar)}};return ap})(i);exports.Param=S=(function(ao){a(ap,ao);function ap(ar,au,at){var aq;this.name=ar;this.value=au;this.splat=at;if(aq=(ar=this.name.unwrapAll().value),c.call(ac,aq)>=0){throw SyntaxError('parameter name "'+ar+'" is not allowed')}}ap.prototype.children=["name","value"];ap.prototype.compile=function(aq){return this.name.compile(aq,G)};ap.prototype.asReference=function(ar){var aq;if(this.reference){return this.reference}aq=this.name;if(aq["this"]){aq=aq.properties[0].name;if(aq.value.reserved){aq=new K(ar.scope.freeVariable(aq.value))}}else{if(aq.isComplex()){aq=new K(ar.scope.freeVariable("arg"))}}aq=new al(aq);if(this.splat){aq=new aa(aq)}return this.reference=aq};ap.prototype.isComplex=function(){return this.name.isComplex()};ap.prototype.names=function(av){var au,aw,ax,aq,ar,at;if(av==null){av=this.name}au=function(ay){var az;az=ay.properties[0].name.value;if(az.reserved){return[]}else{return[az]}};if(av instanceof K){return[av.value]}if(av instanceof al){return au(av)}aw=[];at=av.objects;for(aq=0,ar=at.length;aq<ar;aq++){ax=at[aq];if(ax instanceof h){aw.push(ax.value.unwrap().value)}else{if(ax instanceof aa){aw.push(ax.name.unwrap().value)}else{if(ax instanceof al){if(ax.isArray()||ax.isObject()){aw.push.apply(aw,this.names(ax.base))}else{if(ax["this"]){aw.push.apply(aw,au(ax))}else{aw.push(ax.base.value)}}}else{throw SyntaxError("illegal parameter "+(ax.compile()))}}}}return aw};return ap})(i);exports.Splat=aa=(function(ao){a(ap,ao);ap.prototype.children=["name"];ap.prototype.isAssignable=an;function ap(aq){this.name=aq.compile?aq:new K(aq)}ap.prototype.assigns=function(aq){return this.name.assigns(aq)};ap.prototype.compile=function(aq){if(this.index!=null){return this.compileParam(aq)}else{return this.name.compile(aq)}};ap.prototype.unwrap=function(){return this.name};ap.compileSplattedArray=function(aB,az,at){var au,av,aw,ax,ay,aA,aq,ar;ay=-1;while((aA=az[++ay])&&!(aA instanceof ap)){continue}if(ay>=az.length){return""}if(az.length===1){aw=az[0].compile(aB,G);if(at){return aw}return""+(ak("slice"))+".call("+aw+")"}au=az.slice(ay);for(ax=aq=0,ar=au.length;aq<ar;ax=++aq){aA=au[ax];aw=aA.compile(aB,G);au[ax]=aA instanceof ap?""+(ak("slice"))+".call("+aw+")":"["+aw+"]"}if(ay===0){return au[0]+(".concat("+(au.slice(1).join(", "))+")")}av=(function(){var aC,aD,aE,aF;aE=az.slice(0,ay);aF=[];for(aC=0,aD=aE.length;aC<aD;aC++){aA=aE[aC];aF.push(aA.compile(aB,G))}return aF})();return"["+(av.join(", "))+"].concat("+(au.join(", "))+")"};return ap})(i);exports.While=am=(function(ao){a(ap,ao);function ap(aq,ar){this.condition=(ar!=null?ar.invert:void 0)?aq.invert():aq;this.guard=ar!=null?ar.guard:void 0}ap.prototype.children=["condition","guard","body"];ap.prototype.isStatement=an;ap.prototype.makeReturn=function(aq){if(aq){return ap.__super__.makeReturn.apply(this,arguments)}else{this.returns=!this.jumps({loop:true});return this}};ap.prototype.addBody=function(aq){this.body=aq;return this};ap.prototype.jumps=function(){var at,au,aq,ar;at=this.body.expressions;if(!at.length){return false}for(aq=0,ar=at.length;aq<ar;aq++){au=at[aq];if(au.jumps({loop:true})){return au}}return false};ap.prototype.compileNode=function(at){var aq,ar,au,av;at.indent+=ae;av="";aq=this.body;if(aq.isEmpty()){aq=""}else{if(this.returns){aq.makeReturn(au=at.scope.freeVariable("results"));av=""+this.tab+au+" = [];\n"}if(this.guard){if(aq.expressions.length>1){aq.expressions.unshift(new z((new T(this.guard)).invert(),new K("continue")))}else{if(this.guard){aq=j.wrap([new z(this.guard,aq)])}}}aq="\n"+(aq.compile(at,J))+"\n"+this.tab}ar=av+this.tab+("while ("+(this.condition.compile(at,I))+") {"+aq+"}");if(this.returns){ar+="\n"+this.tab+"return "+au+";"}return ar};return ap})(i);exports.Op=R=(function(ao){var ap,aq;a(ar,ao);function ar(av,at,aw,au){if(av==="in"){return new A(at,aw)}if(av==="do"){return this.generateDo(at)}if(av==="new"){if(at instanceof k&&!at["do"]&&!at.isNew){return at.newInstance()}if(at instanceof n&&at.bound||at["do"]){at=new T(at)}}this.operator=ap[av]||av;this.first=at;this.second=aw;this.flip=!!au;return this}ap={"==":"===","!=":"!==",of:"in"};aq={"!==":"===","===":"!=="};ar.prototype.children=["first","second"];ar.prototype.isSimpleNumber=P;ar.prototype.isUnary=function(){return !this.second};ar.prototype.isComplex=function(){var at;return !(this.isUnary()&&((at=this.operator)==="+"||at==="-"))||this.first.isComplex()};ar.prototype.isChainable=function(){var at;return(at=this.operator)==="<"||at===">"||at===">="||at==="<="||at==="==="||at==="!=="};ar.prototype.invert=function(){var au,av,aw,ax,at;if(this.isChainable()&&this.first.isChainable()){au=true;av=this;while(av&&av.operator){au&&(au=av.operator in aq);av=av.first}if(!au){return new T(this).invert()}av=this;while(av&&av.operator){av.invert=!av.invert;av.operator=aq[av.operator];av=av.first}return this}else{if(ax=aq[this.operator]){this.operator=ax;if(this.first.unwrap() instanceof ar){this.first.invert()}return this}else{if(this.second){return new T(this).invert()}else{if(this.operator==="!"&&(aw=this.first.unwrap()) instanceof ar&&((at=aw.operator)==="!"||at==="in"||at==="instanceof")){return aw}else{return new ar("!",this)}}}}};ar.prototype.unfoldSoak=function(au){var at;return((at=this.operator)==="++"||at==="--"||at==="delete")&&ai(au,this,"first")};ar.prototype.generateDo=function(ax){var aw,ay,az,aA,aB,at,au,av;aA=[];ay=ax instanceof h&&(aB=ax.value.unwrap()) instanceof n?aB:ax;av=ay.params||[];for(at=0,au=av.length;at<au;at++){az=av[at];if(az.value){aA.push(az.value);delete az.value}else{aA.push(az)}}aw=new k(ax,aA);aw["do"]=true;return aw};ar.prototype.compileNode=function(ax){var av,aw,at,au;aw=this.isChainable()&&this.first.isChainable();if(!aw){this.first.front=this.front}if(this.operator==="delete"&&ax.scope.check(this.first.unwrapAll().value)){throw SyntaxError("delete operand may not be argument or var")}if(((at=this.operator)==="--"||at==="++")&&(au=this.first.unwrapAll().value,c.call(ac,au)>=0)){throw SyntaxError("prefix increment/decrement may not have eval or arguments operand")}if(this.isUnary()){return this.compileUnary(ax)}if(aw){return this.compileChain(ax)}if(this.operator==="?"){return this.compileExistence(ax)}av=this.first.compile(ax,H)+" "+this.operator+" "+this.second.compile(ax,H);if(ax.level<=H){return av}else{return"("+av+")"}};ar.prototype.compileChain=function(aw){var au,av,ax,at;at=this.first.second.cache(aw),this.first.second=at[0],ax=at[1];av=this.first.compile(aw,H);au=""+av+" "+(this.invert?"&&":"||")+" "+(ax.compile(aw))+" "+this.operator+" "+(this.second.compile(aw,H));return"("+au+")"};ar.prototype.compileExistence=function(au){var at,av;if(this.first.isComplex()){av=new K(au.scope.freeVariable("ref"));at=new T(new h(av,this.first))}else{at=this.first;av=at}return new z(new s(at),av,{type:"if"}).addElse(this.second).compile(au)};ar.prototype.compileUnary=function(at){var au,av,aw;if(at.level>=E){return(new T(this)).compile(at)}av=[au=this.operator];aw=au==="+"||au==="-";if((au==="new"||au==="typeof"||au==="delete")||aw&&this.first instanceof ar&&this.first.operator===au){av.push(" ")}if((aw&&this.first instanceof ar)||(au==="new"&&this.first.isStatement(at))){this.first=new T(this.first)}av.push(this.first.compile(at,H));if(this.flip){av.reverse()}return av.join("")};ar.prototype.toString=function(at){return ar.__super__.toString.call(this,at,this.constructor.name+" "+this.operator)};return ar})(i);exports.In=A=(function(ao){a(ap,ao);function ap(ar,aq){this.object=ar;this.array=aq}ap.prototype.children=["object","array"];ap.prototype.invert=O;ap.prototype.compileNode=function(av){var au,aw,aq,ar,at;if(this.array instanceof al&&this.array.isArray()){at=this.array.base.objects;for(aq=0,ar=at.length;aq<ar;aq++){aw=at[aq];if(!(aw instanceof aa)){continue}au=true;break}if(!au){return this.compileOrTest(av)}}return this.compileLoopTest(av)};ap.prototype.compileOrTest=function(ax){var at,au,av,aw,ay,az,aA,aq,ar;if(this.array.base.objects.length===0){return""+(!!this.negated)}aq=this.object.cache(ax,H),az=aq[0],ay=aq[1];ar=this.negated?[" !== "," && "]:[" === "," || "],at=ar[0],au=ar[1];aA=(function(){var aB,aC,aD,aE;aD=this.array.base.objects;aE=[];for(av=aB=0,aC=aD.length;aB<aC;av=++aB){aw=aD[av];aE.push((av?ay:az)+at+aw.compile(ax,E))}return aE}).call(this);aA=aA.join(au);if(ax.level<H){return aA}else{return"("+aA+")"}};ap.prototype.compileLoopTest=function(at){var ar,au,av,aq;aq=this.object.cache(at,G),av=aq[0],au=aq[1];ar=ak("indexOf")+(".call("+(this.array.compile(at,G))+", "+au+") ")+(this.negated?"< 0":">= 0");if(av===au){return ar}ar=av+", "+ar;if(at.level<G){return ar}else{return"("+ar+")"}};ap.prototype.toString=function(aq){return ap.__super__.toString.call(this,aq,this.constructor.name+(this.negated?"!":""))};return ap})(i);exports.Try=ah=(function(ao){a(ap,ao);function ap(aq,at,au,ar){this.attempt=aq;this.error=at;this.recovery=au;this.ensure=ar}ap.prototype.children=["attempt","recovery","ensure"];ap.prototype.isStatement=an;ap.prototype.jumps=function(ar){var aq;return this.attempt.jumps(ar)||((aq=this.recovery)!=null?aq.jumps(ar):void 0)};ap.prototype.makeReturn=function(aq){if(this.attempt){this.attempt=this.attempt.makeReturn(aq)}if(this.recovery){this.recovery=this.recovery.makeReturn(aq)}return this};ap.prototype.compileNode=function(au){var aq,ar,at,av;au.indent+=ae;at=this.error?" ("+(this.error.compile(au))+") ":" ";av=this.attempt.compile(au,J);aq=(function(){var aw;if(this.recovery){if(aw=this.error.value,c.call(ac,aw)>=0){throw SyntaxError('catch variable may not be "'+this.error.value+'"')}if(!au.scope.check(this.error.value)){au.scope.add(this.error.value,"param")}return" catch"+at+"{\n"+(this.recovery.compile(au,J))+"\n"+this.tab+"}"}else{if(!(this.ensure||this.recovery)){return" catch (_error) {}"}}}).call(this);ar=this.ensure?" finally {\n"+(this.ensure.compile(au,J))+"\n"+this.tab+"}":"";return""+this.tab+"try {\n"+av+"\n"+this.tab+"}"+(aq||"")+ar};return ap})(i);exports.Throw=ag=(function(ao){a(ap,ao);function ap(aq){this.expression=aq}ap.prototype.children=["expression"];ap.prototype.isStatement=an;ap.prototype.jumps=P;ap.prototype.makeReturn=af;ap.prototype.compileNode=function(aq){return this.tab+("throw "+(this.expression.compile(aq))+";")};return ap})(i);exports.Existence=s=(function(ao){a(ap,ao);function ap(aq){this.expression=aq}ap.prototype.children=["expression"];ap.prototype.invert=O;ap.prototype.compileNode=function(av){var ar,at,au,aq;this.expression.front=this.front;au=this.expression.compile(av,H);if(x.test(au)&&!av.scope.check(au)){aq=this.negated?["===","||"]:["!==","&&"],ar=aq[0],at=aq[1];au="typeof "+au+" "+ar+' "undefined" '+at+" "+au+" "+ar+" null"}else{au=""+au+" "+(this.negated?"==":"!=")+" null"}if(av.level<=F){return au}else{return"("+au+")"}};return ap})(i);exports.Parens=T=(function(ao){a(ap,ao);function ap(aq){this.body=aq}ap.prototype.children=["body"];ap.prototype.unwrap=function(){return this.body};ap.prototype.isComplex=function(){return this.body.isComplex()};ap.prototype.compileNode=function(au){var aq,ar,at;at=this.body.unwrap();if(at instanceof al&&at.isAtomic()){at.front=this.front;return at.compile(au)}ar=at.compile(au,I);aq=au.level<H&&(at instanceof R||at instanceof k||(at instanceof w&&at.returns));if(aq){return ar}else{return"("+ar+")"}};return ap})(i);exports.For=w=(function(ao){a(ap,ao);function ap(ar,at){var aq;this.source=at.source,this.guard=at.guard,this.step=at.step,this.name=at.name,this.index=at.index;this.body=j.wrap([ar]);this.own=!!at.own;this.object=!!at.object;if(this.object){aq=[this.index,this.name],this.name=aq[0],this.index=aq[1]}if(this.index instanceof al){throw SyntaxError("index cannot be a pattern matching expression")}this.range=this.source instanceof al&&this.source.base instanceof U&&!this.source.properties.length;this.pattern=this.name instanceof al;if(this.range&&this.index){throw SyntaxError("indexes do not apply to range loops")}if(this.range&&this.pattern){throw SyntaxError("cannot pattern match over range loops")}this.returns=false}ap.prototype.children=["body","source","guard","step"];ap.prototype.compileNode=function(aG){var ar,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aq;ar=j.wrap([this.body]);aC=(aq=D(ar.expressions))!=null?aq.jumps():void 0;if(aC&&aC instanceof W){this.returns=false}aM=this.range?this.source.base:this.source;aL=aG.scope;aE=this.name&&this.name.compile(aG,G);ay=this.index&&this.index.compile(aG,G);if(aE&&!this.pattern){aL.find(aE)}if(ay){aL.find(ay)}if(this.returns){aK=aL.freeVariable("results")}az=(this.object&&ay)||aL.freeVariable("i");aA=(this.range&&aE)||ay||az;aB=aA!==az?""+aA+" = ":"";if(this.step&&!this.range){aO=aL.freeVariable("step")}if(this.pattern){aE=az}aQ="";aw="";at="";ax=this.tab+ae;if(this.range){au=aM.compile(L(aG,{index:az,name:aE,step:this.step}))}else{aP=this.source.compile(aG,G);if((aE||this.own)&&!x.test(aP)){at=""+this.tab+(aH=aL.freeVariable("ref"))+" = "+aP+";\n";aP=aH}if(aE&&!this.pattern){aF=""+aE+" = "+aP+"["+aA+"]"}if(!this.object){aD=aL.freeVariable("len");av=""+aB+az+" = 0, "+aD+" = "+aP+".length";if(this.step){av+=", "+aO+" = "+(this.step.compile(aG,H))}aN=""+aB+(this.step?""+az+" += "+aO:(aA!==az?"++"+az:""+az+"++"));au=""+av+"; "+az+" < "+aD+"; "+aN}}if(this.returns){aI=""+this.tab+aK+" = [];\n";aJ="\n"+this.tab+"return "+aK+";";ar.makeReturn(aK)}if(this.guard){if(ar.expressions.length>1){ar.expressions.unshift(new z((new T(this.guard)).invert(),new K("continue")))}else{if(this.guard){ar=j.wrap([new z(this.guard,ar)])}}}if(this.pattern){ar.expressions.unshift(new h(this.name,new K(""+aP+"["+aA+"]")))}at+=this.pluckDirectCall(aG,ar);if(aF){aQ="\n"+ax+aF+";"}if(this.object){au=""+aA+" in "+aP;if(this.own){aw="\n"+ax+"if (!"+(ak("hasProp"))+".call("+aP+", "+aA+")) continue;"}}ar=ar.compile(L(aG,{indent:ax}),J);if(ar){ar="\n"+ar+"\n"}return""+at+(aI||"")+this.tab+"for ("+au+") {"+aw+aQ+ar+this.tab+"}"+(aJ||"")};ap.prototype.pluckDirectCall=function(aF,aA){var az,aB,aC,aD,aE,aG,aH,aq,ar,at,au,av,aw,ax,ay;aB="";at=aA.expressions;for(aE=aq=0,ar=at.length;aq<ar;aE=++aq){aC=at[aE];aC=aC.unwrapAll();if(!(aC instanceof k)){continue}aH=aC.variable.unwrapAll();if(!((aH instanceof n)||(aH instanceof al&&((au=aH.base)!=null?au.unwrapAll():void 0) instanceof n&&aH.properties.length===1&&((av=(aw=aH.properties[0].name)!=null?aw.value:void 0)==="call"||av==="apply")))){continue}aD=((ax=aH.base)!=null?ax.unwrapAll():void 0)||aH;aG=new K(aF.scope.freeVariable("fn"));az=new al(aG);if(aH.base){ay=[az,aH],aH.base=ay[0],az=ay[1]}aA.expressions[aE]=new k(az,aC.args);aB+=this.tab+new h(aG,aD).compile(aF,J)+";\n"}return aB};return ap})(am);exports.Switch=ad=(function(ao){a(ap,ao);function ap(at,aq,ar){this.subject=at;this.cases=aq;this.otherwise=ar}ap.prototype.children=["subject","cases","otherwise"];ap.prototype.isStatement=an;ap.prototype.jumps=function(ay){var aw,ax,aq,ar,at,au,av;if(ay==null){ay={block:true}}at=this.cases;for(aq=0,ar=at.length;aq<ar;aq++){au=at[aq],ax=au[0],aw=au[1];if(aw.jumps(ay)){return aw}}return(av=this.otherwise)!=null?av.jumps(ay):void 0};ap.prototype.makeReturn=function(aw){var av,aq,ar,at,au;at=this.cases;for(aq=0,ar=at.length;aq<ar;aq++){av=at[aq];av[1].makeReturn(aw)}if(aw){this.otherwise||(this.otherwise=new j([new K("void 0")]))}if((au=this.otherwise)!=null){au.makeReturn(aw)}return this};ap.prototype.compileNode=function(aI){var az,aA,aB,aC,aD,aE,aF,aG,aH,aq,ar,at,au,av,aw,ax,ay;aG=aI.indent+ae;aH=aI.indent=aG+ae;aB=this.tab+("switch ("+(((av=this.subject)!=null?av.compile(aI,I):void 0)||false)+") {\n");aw=this.cases;for(aF=aq=0,at=aw.length;aq<at;aF=++aq){ax=aw[aF],aD=ax[0],az=ax[1];ay=v([aD]);for(ar=0,au=ay.length;ar<au;ar++){aC=ay[ar];if(!this.subject){aC=aC.invert()}aB+=aG+("case "+(aC.compile(aI,I))+":\n")}if(aA=az.compile(aI,J)){aB+=aA+"\n"}if(aF===this.cases.length-1&&!this.otherwise){break}aE=this.lastNonComment(az.expressions);if(aE instanceof W||(aE instanceof K&&aE.jumps()&&aE.value!=="debugger")){continue}aB+=aH+"break;\n"}if(this.otherwise&&this.otherwise.expressions.length){aB+=aG+("default:\n"+(this.otherwise.compile(aI,J))+"\n")}return aB+this.tab+"}"};return ap})(i);exports.If=z=(function(ao){a(ap,ao);function ap(ar,aq,at){this.body=aq;if(at==null){at={}}this.condition=at.type==="unless"?ar.invert():ar;this.elseBody=null;this.isChain=false;this.soak=at.soak}ap.prototype.children=["condition","body","elseBody"];ap.prototype.bodyNode=function(){var aq;return(aq=this.body)!=null?aq.unwrap():void 0};ap.prototype.elseBodyNode=function(){var aq;return(aq=this.elseBody)!=null?aq.unwrap():void 0};ap.prototype.addElse=function(aq){if(this.isChain){this.elseBodyNode().addElse(aq)}else{this.isChain=aq instanceof ap;this.elseBody=this.ensureBlock(aq)}return this};ap.prototype.isStatement=function(ar){var aq;return(ar!=null?ar.level:void 0)===J||this.bodyNode().isStatement(ar)||((aq=this.elseBodyNode())!=null?aq.isStatement(ar):void 0)};ap.prototype.jumps=function(ar){var aq;return this.body.jumps(ar)||((aq=this.elseBody)!=null?aq.jumps(ar):void 0)};ap.prototype.compileNode=function(aq){if(this.isStatement(aq)){return this.compileStatement(aq)}else{return this.compileExpression(aq)}};ap.prototype.makeReturn=function(aq){if(aq){this.elseBody||(this.elseBody=new j([new K("void 0")]))}this.body&&(this.body=new j([this.body.makeReturn(aq)]));this.elseBody&&(this.elseBody=new j([this.elseBody.makeReturn(aq)]));return this};ap.prototype.ensureBlock=function(aq){if(aq instanceof j){return aq}else{return new j([aq])}};ap.prototype.compileStatement=function(aw){var aq,ar,at,au,av;ar=q(aw,"chainChild");au=q(aw,"isExistentialEquals");if(au){return new ap(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compile(aw)}at=this.condition.compile(aw,I);aw.indent+=ae;aq=this.ensureBlock(this.body);av="if ("+at+") {\n"+(aq.compile(aw))+"\n"+this.tab+"}";if(!ar){av=this.tab+av}if(!this.elseBody){return av}return av+" else "+(this.isChain?(aw.indent=this.tab,aw.chainChild=true,this.elseBody.unwrap().compile(aw,J)):"{\n"+(this.elseBody.compile(aw,J))+"\n"+this.tab+"}")};ap.prototype.compileExpression=function(av){var aq,ar,at,au;au=this.condition.compile(av,F);ar=this.bodyNode().compile(av,G);aq=this.elseBodyNode()?this.elseBodyNode().compile(av,G):"void 0";at=""+au+" ? "+ar+" : "+aq;if(av.level>=F){return"("+at+")"}else{return at}};ap.prototype.unfoldSoak=function(){return this.soak&&this};return ap})(i);m={wrap:function(aq,aw,av){var ao,ap,ar,at,au;if(aq.jumps()){return aq}ar=new n([],j.wrap([aq]));ao=[];if((at=aq.contains(this.literalArgs))||aq.contains(this.literalThis)){au=new K(at?"apply":"call");ao=[new K("this")];if(at){ao.push(new K("arguments"))}ar=new al(ar,[new f(au)])}ar.noReturn=av;ap=new k(ar,ao);if(aw){return j.wrap([ap])}else{return ap}},literalArgs:function(ao){return ao instanceof K&&ao.value==="arguments"&&!ao.asKey},literalThis:function(ao){return(ao instanceof K&&ao.value==="this"&&!ao.asKey)||(ao instanceof n&&ao.bound)||(ao instanceof k&&ao.isSuper)}};ai=function(aq,ar,ap){var ao;if(!(ao=ar[ap].unfoldSoak(aq))){return}ar[ap]=ao.body;ao.body=new al(ar);return ao};aj={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+(ak("hasProp"))+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}};J=1;I=2;G=3;F=4;H=5;E=6;ae="  ";y="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*";x=RegExp("^"+y+"$");Y=/^[+-]?\d+$/;M=RegExp("^(?:("+y+")\\.prototype(?:\\.("+y+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+y+")$");C=/^['"]/;ak=function(ao){var ap;ap="__"+ao;X.root.assign(ap,aj[ao]());return ap};N=function(ao,ap){ao=ao.replace(/\n/g,"$&"+ap);return ao.replace(/\s+$/,"")}}).call(this);