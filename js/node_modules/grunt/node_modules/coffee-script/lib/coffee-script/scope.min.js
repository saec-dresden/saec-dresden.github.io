(function(){var d,b,c,a;a=require("./helpers"),b=a.extend,c=a.last;exports.Scope=d=(function(){e.root=null;function e(h,f,g){this.parent=h;this.expressions=f;this.method=g;this.variables=[{name:"arguments",type:"arguments"}];this.positions={};if(!this.parent){e.root=this}}e.prototype.add=function(g,h,f){if(this.shared&&!f){return this.parent.add(g,h,f)}if(Object.prototype.hasOwnProperty.call(this.positions,g)){return this.variables[this.positions[g]].type=h}else{return this.positions[g]=this.variables.push({name:g,type:h})-1}};e.prototype.namedMethod=function(){if(this.method.name||!this.parent){return this.method}return this.parent.namedMethod()};e.prototype.find=function(f){if(this.check(f)){return true}this.add(f,"var");return false};e.prototype.parameter=function(f){if(this.shared&&this.parent.check(f,true)){return}return this.add(f,"param")};e.prototype.check=function(g){var f;return !!(this.type(g)||((f=this.parent)!=null?f.check(g):void 0))};e.prototype.temporary=function(g,f){if(g.length>1){return"_"+g+(f>1?f-1:"")}else{return"_"+(f+parseInt(g,36)).toString(36).replace(/\d/g,"a")}};e.prototype.type=function(i){var j,f,g,h;h=this.variables;for(f=0,g=h.length;f<g;f++){j=h[f];if(j.name===i){return j.type}}return null};e.prototype.freeVariable=function(g,h){var f,i;if(h==null){h=true}f=0;while(this.check((i=this.temporary(g,f)))){f++}if(h){this.add(i,"var",true)}return i};e.prototype.assign=function(f,g){this.add(f,{value:g,assigned:true},true);return this.hasAssignments=true};e.prototype.hasDeclarations=function(){return !!this.declaredVariables().length};e.prototype.declaredVariables=function(){var i,j,k,f,g,h;i=[];j=[];h=this.variables;for(f=0,g=h.length;f<g;f++){k=h[f];if(k.type==="var"){(k.name.charAt(0)==="_"?j:i).push(k.name)}}return i.sort().concat(j.sort())};e.prototype.assignedVariables=function(){var j,f,g,h,i;h=this.variables;i=[];for(f=0,g=h.length;f<g;f++){j=h[f];if(j.type.assigned){i.push(""+j.name+" = "+j.type.value)}}return i};return e})()}).call(this);