/*
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */
!function(i){var g=Array.isArray?Array.isArray:function a(j){return Object.prototype.toString.call(j)==="[object Array]"};var c=10;function f(){this._events={};if(this._conf){b.call(this,this._conf)}}function b(j){if(j){this._conf=j;j.delimiter&&(this.delimiter=j.delimiter);j.maxListeners&&(this._events.maxListeners=j.maxListeners);j.wildcard&&(this.wildcard=j.wildcard);j.newListener&&(this.newListener=j.newListener);if(this.wildcard){this.listenerTree={}}}}function d(j){this._events={};this.newListener=false;b.call(this,j)}function h(m,u,t,n){if(!t){return[]}var r=[],p,q,j,w,x,o,l,v=u.length,k=u[n],s=u[n+1];if(n===v&&t._listeners){if(typeof t._listeners==="function"){m&&m.push(t._listeners);return[t]}else{for(p=0,q=t._listeners.length;p<q;p++){m&&m.push(t._listeners[p])}return[t]}}if((k==="*"||k==="**")||t[k]){if(k==="*"){for(j in t){if(j!=="_listeners"&&t.hasOwnProperty(j)){r=r.concat(h(m,u,t[j],n+1))}}return r}else{if(k==="**"){l=(n+1===v||(n+2===v&&s==="*"));if(l&&t._listeners){r=r.concat(h(m,u,t,v))}for(j in t){if(j!=="_listeners"&&t.hasOwnProperty(j)){if(j==="*"||j==="**"){if(t[j]._listeners&&!l){r=r.concat(h(m,u,t[j],v))}r=r.concat(h(m,u,t[j],n))}else{if(j===s){r=r.concat(h(m,u,t[j],n+2))}else{r=r.concat(h(m,u,t[j],n))}}}}return r}}r=r.concat(h(m,u,t[k],n+1))}w=t["*"];if(w){h(m,u,w,n+1)}x=t["**"];if(x){if(n<v){if(x._listeners){h(m,u,x,v)}for(j in x){if(j!=="_listeners"&&x.hasOwnProperty(j)){if(j===s){h(m,u,x[j],n+2)}else{if(j===k){h(m,u,x[j],n+1)}else{o={};o[j]=x[j];h(m,u,{"**":o},n+1)}}}}}else{if(x._listeners){h(m,u,x,v)}else{if(x["*"]&&x["*"]._listeners){h(m,u,x["*"],v)}}}}return r}function e(q,l){q=typeof q==="string"?q.split(this.delimiter):q.slice();for(var j=0,k=q.length;j+1<k;j++){if(q[j]==="**"&&q[j+1]==="**"){return}}var p=this.listenerTree;var o=q.shift();while(o){if(!p[o]){p[o]={}}p=p[o];if(q.length===0){if(!p._listeners){p._listeners=l}else{if(typeof p._listeners==="function"){p._listeners=[p._listeners,l]}else{if(g(p._listeners)){p._listeners.push(l);if(!p._listeners.warned){var n=c;if(typeof this._events.maxListeners!=="undefined"){n=this._events.maxListeners}if(n>0&&p._listeners.length>n){p._listeners.warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",p._listeners.length);console.trace()}}}}}return true}o=q.shift()}return true}d.prototype.delimiter=".";d.prototype.setMaxListeners=function(j){this._events||f.call(this);this._events.maxListeners=j;if(!this._conf){this._conf={}}this._conf.maxListeners=j};d.prototype.event="";d.prototype.once=function(j,k){this.many(j,1,k);return this};d.prototype.many=function(j,n,k){var m=this;if(typeof k!=="function"){throw new Error("many only accepts instances of Function")}function l(){if(--n===0){m.off(j,l)}k.apply(this,arguments)}l._origin=k;this.on(j,l);return m};d.prototype.emit=function(){this._events||f.call(this);var q=arguments[0];if(q==="newListener"&&!this.newListener){if(!this._events.newListener){return false}}if(this._all){var n=arguments.length;var j=new Array(n-1);for(var m=1;m<n;m++){j[m-1]=arguments[m]}for(m=0,n=this._all.length;m<n;m++){this.event=q;this._all[m].apply(this,j)}}if(q==="error"){if(!this._all&&!this._events.error&&!(this.wildcard&&this.listenerTree.error)){if(arguments[1] instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}var k;if(this.wildcard){k=[];var p=typeof q==="string"?q.split(this.delimiter):q.slice();h.call(this,k,p,this.listenerTree,0)}else{k=this._events[q]}if(typeof k==="function"){this.event=q;if(arguments.length===1){k.call(this)}else{if(arguments.length>1){switch(arguments.length){case 2:k.call(this,arguments[1]);break;case 3:k.call(this,arguments[1],arguments[2]);break;default:var n=arguments.length;var j=new Array(n-1);for(var m=1;m<n;m++){j[m-1]=arguments[m]}k.apply(this,j)}}}return true}else{if(k){var n=arguments.length;var j=new Array(n-1);for(var m=1;m<n;m++){j[m-1]=arguments[m]}var o=k.slice();for(var m=0,n=o.length;m<n;m++){this.event=q;o[m].apply(this,j)}return(o.length>0)||!!this._all}else{return !!this._all}}};d.prototype.on=function(l,j){if(typeof l==="function"){this.onAny(l);return this}if(typeof j!=="function"){throw new Error("on only accepts instances of Function")}this._events||f.call(this);this.emit("newListener",l,j);if(this.wildcard){e.call(this,l,j);return this}if(!this._events[l]){this._events[l]=j}else{if(typeof this._events[l]==="function"){this._events[l]=[this._events[l],j]}else{if(g(this._events[l])){this._events[l].push(j);if(!this._events[l].warned){var k=c;if(typeof this._events.maxListeners!=="undefined"){k=this._events.maxListeners}if(k>0&&this._events[l].length>k){this._events[l].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[l].length);console.trace()}}}}}return this};d.prototype.onAny=function(j){if(typeof j!=="function"){throw new Error("onAny only accepts instances of Function")}if(!this._all){this._all=[]}this._all.push(j);return this};d.prototype.addListener=d.prototype.on;d.prototype.off=function(s,p){if(typeof p!=="function"){throw new Error("removeListener only takes instances of Function")}var j,n=[];if(this.wildcard){var q=typeof s==="string"?s.split(this.delimiter):s.slice();n=h.call(this,null,q,this.listenerTree,0)}else{if(!this._events[s]){return this}j=this._events[s];n.push({_listeners:j})}for(var l=0;l<n.length;l++){var m=n[l];j=m._listeners;if(g(j)){var r=-1;for(var k=0,o=j.length;k<o;k++){if(j[k]===p||(j[k].listener&&j[k].listener===p)||(j[k]._origin&&j[k]._origin===p)){r=k;break}}if(r<0){continue}if(this.wildcard){m._listeners.splice(r,1)}else{this._events[s].splice(r,1)}if(j.length===0){if(this.wildcard){delete m._listeners}else{delete this._events[s]}}return this}else{if(j===p||(j.listener&&j.listener===p)||(j._origin&&j._origin===p)){if(this.wildcard){delete m._listeners}else{delete this._events[s]}}}}return this};d.prototype.offAny=function(j){var m=0,n=0,k;if(j&&this._all&&this._all.length>0){k=this._all;for(m=0,n=k.length;m<n;m++){if(j===k[m]){k.splice(m,1);return this}}}else{this._all=[]}return this};d.prototype.removeListener=d.prototype.off;d.prototype.removeAllListeners=function(n){if(arguments.length===0){!this._events||f.call(this);return this}if(this.wildcard){var m=typeof n==="string"?n.split(this.delimiter):n.slice();var l=h.call(this,null,m,this.listenerTree,0);for(var j=0;j<l.length;j++){var k=l[j];k._listeners=null}}else{if(!this._events[n]){return this}this._events[n]=null}return this};d.prototype.listeners=function(l){if(this.wildcard){var j=[];var k=typeof l==="string"?l.split(this.delimiter):l.slice();h.call(this,j,k,this.listenerTree,0);return j}this._events||f.call(this);if(!this._events[l]){this._events[l]=[]}if(!g(this._events[l])){this._events[l]=[this._events[l]]}return this._events[l]};d.prototype.listenersAny=function(){if(this._all){return this._all}else{return[]}};if(typeof define==="function"&&define.amd){define(function(){return d})}else{if(typeof exports==="object"){exports.EventEmitter2=d}else{window.EventEmitter2=d}}}();