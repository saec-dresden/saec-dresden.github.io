var path=require("path");var fs=require("fs");var nodeunit=require("nodeunit");var filepaths=fs.readdirSync("test").map(function(a){return path.join("test",a)});var unfinished={};var currentModule;function sendMessage(a){process.stdout.write(JSON.stringify(a)+"\n")}process.on("uncaughtException",function(a){sendMessage({error:[a.name,a.message,a.stack]});process.exit()});var unfinished={};process.on("exit",function(a){var b=Object.keys(unfinished).length;if(b>0){sendMessage({exit:["UNFINISHED"]})}else{sendMessage({exit:["finished"]})}});nodeunit.reporters.test={run:function(b,c,a){var d=b.map(function(e){return path.resolve(e)});nodeunit.runFiles(d,{testspec:undefined,moduleStart:function(e){currentModule=e;sendMessage({moduleStart:[e.toString()]})},moduleDone:function(e){if(e!==currentModule){return}sendMessage({moduleDone:[e.toString()]})},testStart:function(e){unfinished[e]=e;sendMessage({testStart:[e.toString()]})},testDone:function(f,e){delete unfinished[f];sendMessage({testDone:[f.toString(),e.failures(),e.map(function(g){var h=g.error;if(h){g.error={name:h.name,message:h.message,stack:h.stack}}return g})]})},done:function(e){sendMessage({done:[e.failures(),e.duration,e]})}})}};nodeunit.reporters.test.run(filepaths,{});