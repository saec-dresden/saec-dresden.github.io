(function(){if(typeof module==="object"&&module.exports){module.exports=e}else{this.LRUCache=e}function d(k,j){return Object.prototype.hasOwnProperty.call(k,j)}function f(){return 1}function e(j){if(!(this instanceof e)){return new e(j)}if(typeof j==="number"){j={max:j}}if(!j){j={}}this._max=j.max;if(!this._max||!(typeof this._max==="number")||this._max<=0){this._max=Infinity}this._lengthCalculator=j.length||f;if(typeof this._lengthCalculator!=="function"){this._lengthCalculator=f}this._allowStale=j.stale||false;this._maxAge=j.maxAge||null;this._dispose=j.dispose;this.reset()}Object.defineProperty(e.prototype,"max",{set:function(j){if(!j||!(typeof j==="number")||j<=0){j=Infinity}this._max=j;if(this._length>this._max){h(this)}},get:function(){return this._max},enumerable:true});Object.defineProperty(e.prototype,"lengthCalculator",{set:function(k){if(typeof k!=="function"){this._lengthCalculator=f;this._length=this._itemCount;for(var j in this._cache){this._cache[j].length=1}}else{this._lengthCalculator=k;this._length=0;for(var j in this._cache){this._cache[j].length=this._lengthCalculator(this._cache[j].value);this._length+=this._cache[j].length}}if(this._length>this._max){h(this)}},get:function(){return this._lengthCalculator},enumerable:true});Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:true});Object.defineProperty(e.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:true});e.prototype.forEach=function(j,o){o=o||this;var m=0;for(var n=this._mru-1;n>=0&&m<this._itemCount;n--){if(this._lruList[n]){m++;var l=this._lruList[n];if(this._maxAge&&(Date.now()-l.now>this._maxAge)){a(this,l);if(!this._allowStale){l=undefined}}if(l){j.call(o,l.value,l.key,this)}}}};e.prototype.keys=function(){var n=new Array(this._itemCount);var l=0;for(var m=this._mru-1;m>=0&&l<this._itemCount;m--){if(this._lruList[m]){var j=this._lruList[m];n[l++]=j.key}}return n};e.prototype.values=function(){var n=new Array(this._itemCount);var l=0;for(var m=this._mru-1;m>=0&&l<this._itemCount;m--){if(this._lruList[m]){var j=this._lruList[m];n[l++]=j.value}}return n};e.prototype.reset=function(){if(this._dispose&&this._cache){for(var j in this._cache){this._dispose(j,this._cache[j].value)}}this._cache=Object.create(null);this._lruList=Object.create(null);this._mru=0;this._lru=0;this._length=0;this._itemCount=0};e.prototype.dump=function(){return this._cache};e.prototype.dumpLru=function(){return this._lruList};e.prototype.set=function(l,n){if(d(this._cache,l)){if(this._dispose){this._dispose(l,this._cache[l].value)}if(this._maxAge){this._cache[l].now=Date.now()}this._cache[l].value=n;this.get(l);return true}var m=this._lengthCalculator(n);var j=this._maxAge?Date.now():0;var k=new b(l,n,this._mru++,m,j);if(k.length>this._max){if(this._dispose){this._dispose(l,n)}return false}this._length+=k.length;this._lruList[k.lu]=this._cache[l]=k;this._itemCount++;if(this._length>this._max){h(this)}return true};e.prototype.has=function(k){if(!d(this._cache,k)){return false}var j=this._cache[k];if(this._maxAge&&(Date.now()-j.now>this._maxAge)){return false}return true};e.prototype.get=function(j){return c(this,j,true)};e.prototype.peek=function(j){return c(this,j,false)};e.prototype.pop=function(){var j=this._lruList[this._lru];a(this,j);return j||null};e.prototype.del=function(j){a(this,this._cache[j])};function c(m,l,j){var k=m._cache[l];if(k){if(m._maxAge&&(Date.now()-k.now>m._maxAge)){a(m,k);if(!m._allowStale){k=undefined}}else{if(j){i(m,k)}}if(k){k=k.value}}return k}function i(k,j){g(k,j);j.lu=k._mru++;k._lruList[j.lu]=j}function h(j){while(j._lru<j._mru&&j._length>j._max){a(j,j._lruList[j._lru])}}function g(k,j){delete k._lruList[j.lu];while(k._lru<k._mru&&!k._lruList[k._lru]){k._lru++}}function a(k,j){if(j){if(k._dispose){k._dispose(j.key,j.value)}k._length-=j.length;k._itemCount--;delete k._cache[j.key];g(k,j)}}function b(j,n,l,k,m){this.key=j;this.value=n;this.lu=l;this.length=k;this.now=m}})();