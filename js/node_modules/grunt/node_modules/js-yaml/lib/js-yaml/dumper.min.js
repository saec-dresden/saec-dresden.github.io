"use strict";var common=require("./common");var NIL=common.NIL;var YAMLException=require("./exception");var DEFAULT_SCHEMA=require("./schema/default");var SAFE_SCHEMA=require("./schema/safe");var _hasOwnProperty=Object.prototype.hasOwnProperty;var CHAR_TAB=9;var CHAR_LINE_FEED=10;var CHAR_CARRIAGE_RETURN=13;var CHAR_SPACE=32;var CHAR_EXCLAMATION=33;var CHAR_DOUBLE_QUOTE=34;var CHAR_SHARP=35;var CHAR_PERCENT=37;var CHAR_AMPERSAND=38;var CHAR_SINGLE_QUOTE=39;var CHAR_ASTERISK=42;var CHAR_COMMA=44;var CHAR_MINUS=45;var CHAR_COLON=58;var CHAR_GREATER_THAN=62;var CHAR_QUESTION=63;var CHAR_COMMERCIAL_AT=64;var CHAR_LEFT_SQUARE_BRACKET=91;var CHAR_RIGHT_SQUARE_BRACKET=93;var CHAR_GRAVE_ACCENT=96;var CHAR_LEFT_CURLY_BRACKET=123;var CHAR_VERTICAL_LINE=124;var CHAR_RIGHT_CURLY_BRACKET=125;var ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0";ESCAPE_SEQUENCES[7]="\\a";ESCAPE_SEQUENCES[8]="\\b";ESCAPE_SEQUENCES[9]="\\t";ESCAPE_SEQUENCES[10]="\\n";ESCAPE_SEQUENCES[11]="\\v";ESCAPE_SEQUENCES[12]="\\f";ESCAPE_SEQUENCES[13]="\\r";ESCAPE_SEQUENCES[27]="\\e";ESCAPE_SEQUENCES[34]='\\"';ESCAPE_SEQUENCES[92]="\\\\";ESCAPE_SEQUENCES[133]="\\N";ESCAPE_SEQUENCES[160]="\\_";ESCAPE_SEQUENCES[8232]="\\L";ESCAPE_SEQUENCES[8233]="\\P";function kindOf(b){var a=typeof b;if(null===b){return"null"}else{if("number"===a){return 0===b%1?"integer":"float"}else{if("object"===a&&Array.isArray(b)){return"array"}else{return a}}}}function compileStyleMap(f,d){var e,b,a,c,h,g,i;if(null===d){return{}}e={};b=Object.keys(d);for(a=0,c=b.length;a<c;a+=1){h=b[a];g=String(d[h]);if("!!"===h.slice(0,2)){h="tag:yaml.org,2002:"+h.slice(2)}i=f.compiledTypeMap[h];if(i&&i.dumper){if(_hasOwnProperty.call(i.dumper.styleAliases,g)){g=i.dumper.styleAliases[g]}}e[h]=g}return e}function encodeHex(a){var d,b,c;d=a.toString(16).toUpperCase();if(a<=255){b="x";c=2}else{if(a<=65535){b="u";c=4}else{if(a<=4294967295){b="U";c=8}else{throw new YAMLException("code point within a string may not be greater than 0xFFFFFFFF")}}}return"\\"+b+common.repeat("0",c-d.length)+d}function dump(g,i){i=i||{};var k=i.schema||DEFAULT_SCHEMA,f=Math.max(1,(i.indent||2)),c=(common.isNothing(i.flowLevel)?-1:i.flowLevel),l=compileStyleMap(k,i.styles||null),e=k.compiledImplicit,b=k.compiledExplicit,h,m,j;function d(u){return"\n"+common.repeat(" ",f*u)}function n(w){var u,v,x;for(u=0,v=e.length;u<v;u+=1){x=e[u];if(null!==x.loader&&NIL!==x.loader.resolver(w,false)){return true}}return false}function t(y){var w,v,z,x,u;j="";w=false;v=0;if(0===y.length||CHAR_SPACE===y.charCodeAt(0)||CHAR_SPACE===y.charCodeAt(y.length-1)){w=true}for(z=0,x=y.length;z<x;z+=1){u=y.charCodeAt(z);if(!w){if(CHAR_TAB===u||CHAR_LINE_FEED===u||CHAR_CARRIAGE_RETURN===u||CHAR_COMMA===u||CHAR_LEFT_SQUARE_BRACKET===u||CHAR_RIGHT_SQUARE_BRACKET===u||CHAR_LEFT_CURLY_BRACKET===u||CHAR_RIGHT_CURLY_BRACKET===u||CHAR_SHARP===u||CHAR_AMPERSAND===u||CHAR_ASTERISK===u||CHAR_EXCLAMATION===u||CHAR_VERTICAL_LINE===u||CHAR_GREATER_THAN===u||CHAR_SINGLE_QUOTE===u||CHAR_DOUBLE_QUOTE===u||CHAR_PERCENT===u||CHAR_COMMERCIAL_AT===u||CHAR_GRAVE_ACCENT===u||CHAR_QUESTION===u||CHAR_COLON===u||CHAR_MINUS===u){w=true}}if(ESCAPE_SEQUENCES[u]||!((32<=u&&u<=126)||(133===u)||(160<=u&&u<=55295)||(57344<=u&&u<=65533)||(65536<=u&&u<=1114111))){j+=y.slice(v,z);j+=ESCAPE_SEQUENCES[u]||encodeHex(u);v=z+1;w=true}}if(v<z){j+=y.slice(v,z)}if(!w&&n(j)){w=true}if(w){j='"'+j+'"'}}function r(y,z){var u="",v=m,w,x;for(w=0,x=z.length;w<x;w+=1){if(0!==w){u+=", "}s(y,z[w],false,false);u+=j}m=v;j="["+u+"]"}function p(z,A,w){var u="",v=m,x,y;for(x=0,y=A.length;x<y;x+=1){if(!w||0!==x){u+=d(z)}s(z+1,A[x],true,true);u+="- "+j}m=v;j=u}function q(y,z){var u="",v=m,B=Object.keys(z),w,x,A,C;for(w=0,x=B.length;w<x;w+=1){if(0!==w){u+=", "}A=B[w];C=z[A];s(y,A,false,false);if(j.length>1024){u+="? "}u+=j+": ";s(y,C,false,false);u+=j}m=v;j="{"+u+"}"}function o(A,B,w){var u="",v=m,D=Object.keys(B),y,z,C,E,x;for(y=0,z=D.length;y<z;y+=1){if(!w||0!==y){u+=d(A)}C=D[y];E=B[C];s(A+1,C,true,true);x=(null!==m&&"?"!==m&&j.length<=1024);if(x){u+="? "}u+=j;if(x){u+=d(A)}s(A+1,E,true,x);u+=": "+j}m=v;j=u}function a(y,v){var u,B,w,x,A,z;B=v?b:e;h=kindOf(y);for(w=0,x=B.length;w<x;w+=1){A=B[w];if((null!==A.dumper)&&(null===A.dumper.kind||h===A.dumper.kind)&&(null===A.dumper.instanceOf||y instanceof A.dumper.instanceOf)&&(null===A.dumper.predicate||A.dumper.predicate(y))){m=v?A.tag:"?";if(null!==A.dumper.representer){z=l[A.tag]||A.dumper.defaultStyle;if("function"===typeof A.dumper.representer){u=A.dumper.representer(y,z)}else{if(_hasOwnProperty.call(A.dumper.representer,z)){u=A.dumper.representer[z](y,z)}else{throw new YAMLException("!<"+A.tag+'> tag resolver accepts not "'+z+'" style')}}if(NIL!==u){h=kindOf(u);j=u}else{if(v){throw new YAMLException("cannot represent an object of !<"+A.tag+"> type")}else{continue}}}return true}}return false}function s(w,x,u,v){m=null;j=x;if(!a(x,false)){a(x,true)}if(u){u=(0>c||c>w)}if((null!==m&&"?"!==m)||(2!==f&&w>0)){v=false}if("object"===h){if(u&&(0!==Object.keys(j).length)){o(w,j,v)}else{q(w,j)}}else{if("array"===h){if(u&&(0!==j.length)){p(w,j,v)}else{r(w,j)}}else{if("string"===h){if("?"!==m){t(j)}}else{throw new YAMLException("unacceptabe kind of an object to dump ("+h+")")}}}if(null!==m&&"?"!==m){j="!<"+m+"> "+j}}s(0,g,true,true);return j+"\n"}function safeDump(a,b){return dump(a,common.extend({schema:SAFE_SCHEMA},b))}module.exports.dump=dump;module.exports.safeDump=safeDump;