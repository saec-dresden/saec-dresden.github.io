"use strict";var common=require("./common");var YAMLException=require("./exception");var Mark=require("./mark");var NIL=common.NIL;var SAFE_SCHEMA=require("./schema/safe");var DEFAULT_SCHEMA=require("./schema/default");var _hasOwnProperty=Object.prototype.hasOwnProperty;var KIND_STRING="string";var KIND_ARRAY="array";var KIND_OBJECT="object";var CONTEXT_FLOW_IN=1;var CONTEXT_FLOW_OUT=2;var CONTEXT_BLOCK_IN=3;var CONTEXT_BLOCK_OUT=4;var CHOMPING_CLIP=1;var CHOMPING_STRIP=2;var CHOMPING_KEEP=3;var CHAR_TAB=9;var CHAR_LINE_FEED=10;var CHAR_CARRIAGE_RETURN=13;var CHAR_SPACE=32;var CHAR_EXCLAMATION=33;var CHAR_DOUBLE_QUOTE=34;var CHAR_SHARP=35;var CHAR_PERCENT=37;var CHAR_AMPERSAND=38;var CHAR_SINGLE_QUOTE=39;var CHAR_ASTERISK=42;var CHAR_PLUS=43;var CHAR_COMMA=44;var CHAR_MINUS=45;var CHAR_DOT=46;var CHAR_SLASH=47;var CHAR_DIGIT_ZERO=48;var CHAR_DIGIT_ONE=49;var CHAR_DIGIT_NINE=57;var CHAR_COLON=58;var CHAR_LESS_THAN=60;var CHAR_GREATER_THAN=62;var CHAR_QUESTION=63;var CHAR_COMMERCIAL_AT=64;var CHAR_CAPITAL_A=65;var CHAR_CAPITAL_F=70;var CHAR_CAPITAL_L=76;var CHAR_CAPITAL_N=78;var CHAR_CAPITAL_P=80;var CHAR_CAPITAL_U=85;var CHAR_LEFT_SQUARE_BRACKET=91;var CHAR_BACKSLASH=92;var CHAR_RIGHT_SQUARE_BRACKET=93;var CHAR_UNDERSCORE=95;var CHAR_GRAVE_ACCENT=96;var CHAR_SMALL_A=97;var CHAR_SMALL_B=98;var CHAR_SMALL_E=101;var CHAR_SMALL_F=102;var CHAR_SMALL_N=110;var CHAR_SMALL_R=114;var CHAR_SMALL_T=116;var CHAR_SMALL_U=117;var CHAR_SMALL_V=118;var CHAR_SMALL_X=120;var CHAR_LEFT_CURLY_BRACKET=123;var CHAR_VERTICAL_LINE=124;var CHAR_RIGHT_CURLY_BRACKET=125;var SIMPLE_ESCAPE_SEQUENCES={};SIMPLE_ESCAPE_SEQUENCES[CHAR_DIGIT_ZERO]="\x00";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_A]="\x07";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_B]="\x08";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_T]="\x09";SIMPLE_ESCAPE_SEQUENCES[CHAR_TAB]="\x09";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_N]="\x0A";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_V]="\x0B";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_F]="\x0C";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_R]="\x0D";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_E]="\x1B";SIMPLE_ESCAPE_SEQUENCES[CHAR_SPACE]=" ";SIMPLE_ESCAPE_SEQUENCES[CHAR_DOUBLE_QUOTE]="\x22";SIMPLE_ESCAPE_SEQUENCES[CHAR_SLASH]="/";SIMPLE_ESCAPE_SEQUENCES[CHAR_BACKSLASH]="\x5C";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_N]="\x85";SIMPLE_ESCAPE_SEQUENCES[CHAR_UNDERSCORE]="\xA0";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_L]="\u2028";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_P]="\u2029";var HEXADECIMAL_ESCAPE_SEQUENCES={};HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_SMALL_X]=2;HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_SMALL_U]=4;HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_CAPITAL_U]=8;var PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uD800-\uDFFF\uFFFE\uFFFF]/;var PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/;var PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/;var PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i;var PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function loadAll(m,v,u){u=u||{};var h=u.filename||null,L=u.schema||DEFAULT_SCHEMA,J=u.resolve||true,V=u.validate||true,O=u.strict||false,o=u.legacy||false,g={},l=L.compiledImplicit,U=L.compiledTypeMap,p=m.length,w=0,q=0,s=0,r=0,d=m.charCodeAt(w),W,e,Q,b,P,a,n,K;function i(Y){return new YAMLException(Y,new Mark(h,m,w,q,(w-s)))}function S(Y){throw i(Y)}function T(Z){var Y=i(Z);if(O){throw Y}else{console.warn(Y.toString())}}g.YAML=function k(ac,Y){var aa,Z,ab;if(null!==W){S("duplication of %YAML directive")}if(1!==Y.length){S("YAML directive accepts exactly one argument")}aa=/^([0-9]+)\.([0-9]+)$/.exec(Y[0]);if(null===aa){S("ill-formed argument of the YAML directive")}Z=parseInt(aa[1],10);ab=parseInt(aa[2],10);if(1!==Z){S("unacceptable YAML version of the document")}W=Y[0];e=(ab<2);if(1!==ab&&2!==ab){T("unsupported YAML version of the document")}};g.TAG=function j(aa,Y){var Z,ab;if(2!==Y.length){S("TAG directive accepts exactly two arguments")}Z=Y[0];ab=Y[1];if(!PATTERN_TAG_HANDLE.test(Z)){S("ill-formed tag handle (first argument) of the TAG directive")}if(_hasOwnProperty.call(Q,Z)){S('there is a previously declared suffix for "'+Z+'" tag handle')}if(!PATTERN_TAG_URI.test(ab)){S("ill-formed tag prefix (second argument) of the TAG directive")}Q[Z]=ab};function c(ae,ad,ac){var aa,Z,Y,ab;if(ae<ad){ab=m.slice(ae,ad);if(ac&&V){for(aa=0,Z=ab.length;aa<Z;aa+=1){Y=ab.charCodeAt(aa);if(!(9===Y||32<=Y&&Y<=1114111)){S("expected valid JSON character")}}}K+=ab}}function t(Y,ac){var ad,aa,Z,ab;if(!common.isObject(ac)){S("cannot merge mappings; the provided source object is unacceptable")}ad=Object.keys(ac);for(Z=0,ab=ad.length;Z<ab;Z+=1){aa=ad[Z];if(!_hasOwnProperty.call(Y,aa)){Y[aa]=ac[aa]}}}function N(Y,ab,aa,ad){var Z,ac;aa=String(aa);if(null===Y){Y={}}if("tag:yaml.org,2002:merge"===ab){if(Array.isArray(ad)){for(Z=0,ac=ad.length;Z<ac;Z+=1){t(Y,ad[Z])}}else{t(Y,ad)}}else{Y[aa]=ad}return Y}function F(){if(CHAR_LINE_FEED===d){w+=1}else{if(CHAR_CARRIAGE_RETURN===d){if(CHAR_LINE_FEED===m.charCodeAt(w+1)){w+=2}else{w+=1}}else{S("a line break is expected")}}q+=1;s=w;d=m.charCodeAt(w)}function M(Y,Z){var aa=0;while(w<p){while(CHAR_SPACE===d||CHAR_TAB===d){d=m.charCodeAt(++w)}if(Y&&CHAR_SHARP===d){do{d=m.charCodeAt(++w)}while(w<p&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d)}if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){F();aa+=1;r=0;while(CHAR_SPACE===d){r+=1;d=m.charCodeAt(++w)}if(r<Z){T("deficient indentation")}}else{break}}return aa}function R(){var Z,Y;if(w===s&&(CHAR_MINUS===d||CHAR_DOT===d)&&m.charCodeAt(w+1)===d&&m.charCodeAt(w+2)===d){Z=w+3;Y=m.charCodeAt(Z);if(Z>=p||CHAR_SPACE===Y||CHAR_TAB===Y||CHAR_LINE_FEED===Y||CHAR_CARRIAGE_RETURN===Y){return true}}return false}function X(Y){if(1===Y){K+=" "}else{if(Y>1){K+=common.repeat("\n",Y-1)}}}function G(ah,aj){var ai,af,ae,ad,ag,Z,ab,aa,Y=n,ac=K;if(CHAR_SPACE===d||CHAR_TAB===d||CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d||CHAR_COMMA===d||CHAR_LEFT_SQUARE_BRACKET===d||CHAR_RIGHT_SQUARE_BRACKET===d||CHAR_LEFT_CURLY_BRACKET===d||CHAR_RIGHT_CURLY_BRACKET===d||CHAR_SHARP===d||CHAR_AMPERSAND===d||CHAR_ASTERISK===d||CHAR_EXCLAMATION===d||CHAR_VERTICAL_LINE===d||CHAR_GREATER_THAN===d||CHAR_SINGLE_QUOTE===d||CHAR_DOUBLE_QUOTE===d||CHAR_PERCENT===d||CHAR_COMMERCIAL_AT===d||CHAR_GRAVE_ACCENT===d){return false}if(CHAR_QUESTION===d||CHAR_MINUS===d){af=m.charCodeAt(w+1);if(CHAR_SPACE===af||CHAR_TAB===af||CHAR_LINE_FEED===af||CHAR_CARRIAGE_RETURN===af||aj&&(CHAR_COMMA===af||CHAR_LEFT_SQUARE_BRACKET===af||CHAR_RIGHT_SQUARE_BRACKET===af||CHAR_LEFT_CURLY_BRACKET===af||CHAR_RIGHT_CURLY_BRACKET===af)){return false}}n=KIND_STRING;K="";ae=ad=w;ag=false;while(w<p){if(CHAR_COLON===d){af=m.charCodeAt(w+1);if(CHAR_SPACE===af||CHAR_TAB===af||CHAR_LINE_FEED===af||CHAR_CARRIAGE_RETURN===af||aj&&(CHAR_COMMA===af||CHAR_LEFT_SQUARE_BRACKET===af||CHAR_RIGHT_SQUARE_BRACKET===af||CHAR_LEFT_CURLY_BRACKET===af||CHAR_RIGHT_CURLY_BRACKET===af)){break}}else{if(CHAR_SHARP===d){ai=m.charCodeAt(w-1);if(CHAR_SPACE===ai||CHAR_TAB===ai||CHAR_LINE_FEED===ai||CHAR_CARRIAGE_RETURN===ai){break}}else{if((w===s&&R())||aj&&(CHAR_COMMA===d||CHAR_LEFT_SQUARE_BRACKET===d||CHAR_RIGHT_SQUARE_BRACKET===d||CHAR_LEFT_CURLY_BRACKET===d||CHAR_RIGHT_CURLY_BRACKET===d)){break}else{if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){Z=q;ab=s;aa=r;M(false,-1);if(r>=ah){ag=true;continue}else{w=ad;q=Z;s=ab;r=aa;d=m.charCodeAt(w);break}}}}}if(ag){c(ae,ad,false);X(q-Z);ae=ad=w;ag=false}if(CHAR_SPACE!==d&&CHAR_TAB!==d){ad=w+1}d=m.charCodeAt(++w)}c(ae,ad,false);if(K){return true}else{n=Y;K=ac;return false}}function H(aa){var Z,Y;if(CHAR_SINGLE_QUOTE!==d){return false}n=KIND_STRING;K="";d=m.charCodeAt(++w);Z=Y=w;while(w<p){if(CHAR_SINGLE_QUOTE===d){c(Z,w,true);d=m.charCodeAt(++w);if(CHAR_SINGLE_QUOTE===d){Z=Y=w;d=m.charCodeAt(++w)}else{return true}}else{if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){c(Z,Y,true);X(M(false,aa));Z=Y=w;d=m.charCodeAt(w)}else{if(w===s&&R()){S("unexpected end of the document within a single quoted scalar")}else{d=m.charCodeAt(++w);Y=w}}}}S("unexpected end of the stream within a single quoted scalar")}function D(ae){var Z,Y,ab,aa,ac,ad;if(CHAR_DOUBLE_QUOTE!==d){return false}n=KIND_STRING;K="";d=m.charCodeAt(++w);Z=Y=w;while(w<p){if(CHAR_DOUBLE_QUOTE===d){c(Z,w,true);d=m.charCodeAt(++w);return true}else{if(CHAR_BACKSLASH===d){c(Z,w,true);d=m.charCodeAt(++w);if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){M(false,ae)}else{if(SIMPLE_ESCAPE_SEQUENCES[d]){K+=SIMPLE_ESCAPE_SEQUENCES[d];d=m.charCodeAt(++w)}else{if(HEXADECIMAL_ESCAPE_SEQUENCES[d]){ab=HEXADECIMAL_ESCAPE_SEQUENCES[d];ad=0;for(aa=1;aa<=ab;aa+=1){ac=(ab-aa)*4;d=m.charCodeAt(++w);if(CHAR_DIGIT_ZERO<=d&&d<=CHAR_DIGIT_NINE){ad|=(d-CHAR_DIGIT_ZERO)<<ac}else{if(CHAR_CAPITAL_A<=d&&d<=CHAR_CAPITAL_F){ad|=(d-CHAR_CAPITAL_A+10)<<ac}else{if(CHAR_SMALL_A<=d&&d<=CHAR_SMALL_F){ad|=(d-CHAR_SMALL_A+10)<<ac}else{S("expected hexadecimal character")}}}}K+=String.fromCharCode(ad);d=m.charCodeAt(++w)}else{S("unknown escape sequence")}}}Z=Y=w}else{if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){c(Z,Y,true);X(M(false,ae));Z=Y=w;d=m.charCodeAt(w)}else{if(w===s&&R()){S("unexpected end of the document within a double quoted scalar")}else{d=m.charCodeAt(++w);Y=w}}}}}S("unexpected end of the stream within a double quoted scalar")}function E(ah){var ai=true,Y,aa=P,Z,ab,aj,ae,ac,ad,af,ag,ak;switch(d){case CHAR_LEFT_SQUARE_BRACKET:aj=CHAR_RIGHT_SQUARE_BRACKET;ad=false;Z=[];break;case CHAR_LEFT_CURLY_BRACKET:aj=CHAR_RIGHT_CURLY_BRACKET;ad=true;Z={};break;default:return false}if(null!==a){b[a]=Z}d=m.charCodeAt(++w);while(w<p){M(true,ah);if(d===aj){d=m.charCodeAt(++w);P=aa;n=ad?KIND_OBJECT:KIND_ARRAY;K=Z;return true}else{if(!ai){S("missed comma between flow collection entries")}}ag=af=ak=null;ae=ac=false;if(CHAR_QUESTION===d){ab=m.charCodeAt(w+1);if(CHAR_SPACE===ab||CHAR_TAB===ab||CHAR_LINE_FEED===ab||CHAR_CARRIAGE_RETURN===ab){ae=ac=true;w+=1;d=ab;M(true,ah)}}Y=q;f(ah,CONTEXT_FLOW_IN,false,true);ag=P;af=K;if((ac||q===Y)&&CHAR_COLON===d){ae=true;d=m.charCodeAt(++w);M(true,ah);f(ah,CONTEXT_FLOW_IN,false,true);ak=K}if(ad){N(Z,ag,af,ak)}else{if(ae){Z.push(N(null,ag,af,ak))}else{Z.push(af)}}M(true,ah);if(CHAR_COMMA===d){ai=true;d=m.charCodeAt(++w)}else{ai=false}}S("unexpected end of the stream within a flow collection")}function A(ad){var Y,ac,Z=CHOMPING_CLIP,aa=false,ae=ad,ab=-1;switch(d){case CHAR_VERTICAL_LINE:ac=false;break;case CHAR_GREATER_THAN:ac=true;break;default:return false}n=KIND_STRING;K="";while(w<p){d=m.charCodeAt(++w);if(CHAR_PLUS===d||CHAR_MINUS===d){if(CHOMPING_CLIP===Z){Z=(CHAR_PLUS===d)?CHOMPING_KEEP:CHOMPING_STRIP}else{S("repeat of a chomping mode identifier")}}else{if(CHAR_DIGIT_ZERO<=d&&d<=CHAR_DIGIT_NINE){if(CHAR_DIGIT_ZERO===d){S("bad explicit indentation width of a block scalar; it cannot be less than one")}else{if(!aa){ae=ad+(d-CHAR_DIGIT_ONE);aa=true}else{S("repeat of an indentation width identifier")}}}else{break}}}if(CHAR_SPACE===d||CHAR_TAB===d){do{d=m.charCodeAt(++w)}while(CHAR_SPACE===d||CHAR_TAB===d);if(CHAR_SHARP===d){do{d=m.charCodeAt(++w)}while(w<p&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d)}}while(w<p){F();r=0;while((!aa||r<ae)&&(CHAR_SPACE===d)){r+=1;d=m.charCodeAt(++w)}if(!aa&&r>ae){ae=r}if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){ab+=1;continue}if(r<ae){if(CHOMPING_KEEP===Z){K+=common.repeat("\n",ab+1)}else{if(CHOMPING_CLIP===Z){K+="\n"}}break}aa=true;if(ac){if(CHAR_SPACE===d||CHAR_TAB===d){K+=common.repeat("\n",ab+1);ab=1}else{if(0===ab){K+=" ";ab=0}else{K+=common.repeat("\n",ab);ab=0}}}else{K+=common.repeat("\n",ab+1);ab=0}Y=w;do{d=m.charCodeAt(++w)}while(w<p&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d);c(Y,w,false)}return true}function B(ad){var Y,aa=P,Z=[],ac,ab=false;if(null!==a){b[a]=Z}while(w<p){if(CHAR_MINUS!==d){break}ac=m.charCodeAt(w+1);if(CHAR_SPACE!==ac&&CHAR_TAB!==ac&&CHAR_LINE_FEED!==ac&&CHAR_CARRIAGE_RETURN!==ac){break}ab=true;w+=1;d=ac;if(M(true,-1)){if(r<=ad){Z.push(null);continue}}Y=q;f(ad,CONTEXT_BLOCK_IN,false,true);Z.push(K);M(true,-1);if((q===Y||r>ad)&&w<p){S("bad indentation of a sequence entry")}else{if(r<ad){break}}}if(ab){P=aa;n=KIND_ARRAY;K=Z;return true}else{return false}}function z(ah){var ae,ab,Y,aa=P,Z={},ag=null,af=null,ai=null,ac=false,ad=false;if(null!==a){b[a]=Z}while(w<p){ae=m.charCodeAt(w+1);Y=q;if((CHAR_QUESTION===d||CHAR_COLON===d)&&(CHAR_SPACE===ae||CHAR_TAB===ae||CHAR_LINE_FEED===ae||CHAR_CARRIAGE_RETURN===ae)){if(CHAR_QUESTION===d){if(ac){N(Z,ag,af,null);ag=af=ai=null}ad=true;ac=true;ab=true}else{if(ac){ac=false;ab=true}else{S("incomplete explicit mapping pair; a key node is missed")}}w+=1;d=ae}else{if(f(ah,CONTEXT_FLOW_OUT,false,true)){if(q===Y){while(CHAR_SPACE===d||CHAR_TAB===d){d=m.charCodeAt(++w)}if(CHAR_COLON===d){d=m.charCodeAt(++w);if(CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d){S("a whitespace character is expected after the key-value separator within a block mapping")}if(ac){N(Z,ag,af,null);ag=af=ai=null}ad=true;ac=false;ab=false;ag=P;af=K}else{if(ad){S("can not read an implicit mapping pair; a colon is missed")}else{P=aa;return true}}}else{if(ad){S("can not read a block mapping entry; a multiline key may not be an implicit key")}else{P=aa;return true}}}else{break}}if(q===Y||r>ah){if(f(ah,CONTEXT_BLOCK_OUT,true,ab)){if(ac){af=K}else{ai=K}}if(!ac){N(Z,ag,af,ai);ag=af=ai=null}M(true,-1)}if(r>ah&&w<p){S("bad indentation of a mapping entry")}else{if(r<ah){break}}}if(ac){N(Z,ag,af,null)}if(ad){P=aa;n=KIND_OBJECT;K=Z}return ad}function I(){var Y,aa=false,Z=false,ab,ac;if(CHAR_EXCLAMATION!==d){return false}if(null!==P){S("duplication of a tag property")}d=m.charCodeAt(++w);if(CHAR_LESS_THAN===d){aa=true;d=m.charCodeAt(++w)}else{if(CHAR_EXCLAMATION===d){Z=true;ab="!!";d=m.charCodeAt(++w)}else{ab="!"}}Y=w;if(aa){do{d=m.charCodeAt(++w)}while(w<p&&CHAR_GREATER_THAN!==d);if(w<p){ac=m.slice(Y,w);d=m.charCodeAt(++w)}else{S("unexpected end of the stream within a verbatim tag")}}else{while(w<p&&CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d){if(CHAR_EXCLAMATION===d){if(!Z){ab=m.slice(Y-1,w+1);if(V&&!PATTERN_TAG_HANDLE.test(ab)){S("named tag handle cannot contain such characters")}Z=true;Y=w+1}else{S("tag suffix cannot contain exclamation marks")}}d=m.charCodeAt(++w)}ac=m.slice(Y,w);if(V&&PATTERN_FLOW_INDICATORS.test(ac)){S("tag suffix cannot contain flow indicator characters")}}if(V&&ac&&!PATTERN_TAG_URI.test(ac)){S("tag name cannot contain such characters: "+ac)}if(aa){P=ac}else{if(_hasOwnProperty.call(Q,ab)){P=Q[ab]+ac}else{if("!"===ab){P="!"+ac}else{if("!!"===ab){P="tag:yaml.org,2002:"+ac}else{S('undeclared tag handle "'+ab+'"')}}}}return true}function y(){var Y;if(CHAR_AMPERSAND!==d){return false}if(null!==a){S("duplication of an anchor property")}d=m.charCodeAt(++w);Y=w;while(w<p&&CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d&&CHAR_COMMA!==d&&CHAR_LEFT_SQUARE_BRACKET!==d&&CHAR_RIGHT_SQUARE_BRACKET!==d&&CHAR_LEFT_CURLY_BRACKET!==d&&CHAR_RIGHT_CURLY_BRACKET!==d){d=m.charCodeAt(++w)}if(w===Y){S("name of an anchor node must contain at least one character")}a=m.slice(Y,w);return true}function x(){var Y,Z;if(CHAR_ASTERISK!==d){return false}d=m.charCodeAt(++w);Y=w;while(w<p&&CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d&&CHAR_COMMA!==d&&CHAR_LEFT_SQUARE_BRACKET!==d&&CHAR_RIGHT_SQUARE_BRACKET!==d&&CHAR_LEFT_CURLY_BRACKET!==d&&CHAR_RIGHT_CURLY_BRACKET!==d){d=m.charCodeAt(++w)}if(w===Y){S("name of an alias node must contain at least one character")}Z=m.slice(Y,w);if(!b.hasOwnProperty(Z)){S('unidentified alias "'+Z+'"')}K=b[Z];M(true,-1);return true}function f(ak,aj,ad,ac){var ab,aa,Z,ae=false,ai=true,ah=false,am,ao,al,an,ag,af,Y;P=null;a=null;n=null;K=null;ab=aa=Z=CONTEXT_BLOCK_OUT===aj||CONTEXT_BLOCK_IN===aj;if(ad){if(M(true,-1)){ae=true;if(r===ak){ai=false}else{if(r>ak){ai=true}else{return false}}}}if(ai){while(I()||y()){if(M(true,-1)){ae=true;if(r>ak){ai=true;Z=ab}else{if(r===ak){ai=false;Z=ab}else{return true}}}else{Z=false}}}if(Z){Z=ae||ac}if(ai||CONTEXT_BLOCK_OUT===aj){if(CONTEXT_FLOW_IN===aj||CONTEXT_FLOW_OUT===aj){ag=ak}else{ag=ak+1}af=w-s;if(ai){if(Z&&(B(af)||z(af))||E(ag)){ah=true}else{if((aa&&A(ag))||H(ag)||D(ag)){ah=true}else{if(x()){ah=true;if(null!==P||null!==a){S("alias node should not have any properties")}}else{if(G(ag,CONTEXT_FLOW_IN===aj)){ah=true;if(null===P){P="?"}}}}if(null!==a){b[a]=K}}}else{ah=Z&&B(af)}}if(null!==P&&"!"!==P){if("?"===P){if(J){for(am=0,ao=l.length;am<ao;am+=1){al=l[am];Y=al.loader.resolver(K,false);if(NIL!==Y){P=al.tag;K=Y;break}}}}else{if(_hasOwnProperty.call(U,P)){an=U[P].loader;if(null!==K&&an.kind!==n){S("unacceptable node kind for !<"+P+'> tag; it should be "'+an.kind+'", not "'+n+'"')}if(an.resolver){Y=an.resolver(K,true);if(NIL!==Y){K=Y}else{S("cannot resolve a node with !<"+P+"> explicit tag")}}}else{T("unknown tag !<"+P+">")}}}return null!==P||null!==a||ah}function C(){var ab=w,Y,aa,Z,ac=false;W=null;e=o;Q={};b={};while(w<p){M(true,-1);if(r>0||CHAR_PERCENT!==d){break}ac=true;d=m.charCodeAt(++w);Y=w;while(w<p&&CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d){d=m.charCodeAt(++w)}aa=m.slice(Y,w);Z=[];if(aa.length<1){S("directive name must not be less than one character in length")}while(w<p){while(CHAR_SPACE===d||CHAR_TAB===d){d=m.charCodeAt(++w)}if(CHAR_SHARP===d){do{d=m.charCodeAt(++w)}while(w<p&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d);break}if(CHAR_LINE_FEED===d||CHAR_CARRIAGE_RETURN===d){break}Y=w;while(w<p&&CHAR_SPACE!==d&&CHAR_TAB!==d&&CHAR_LINE_FEED!==d&&CHAR_CARRIAGE_RETURN!==d){d=m.charCodeAt(++w)}Z.push(m.slice(Y,w))}if(w<p){F()}if(_hasOwnProperty.call(g,aa)){g[aa](aa,Z)}else{T('unknown document directive "'+aa+'"')}}M(true,-1);if(0===r&&CHAR_MINUS===d&&CHAR_MINUS===m.charCodeAt(w+1)&&CHAR_MINUS===m.charCodeAt(w+2)){w+=3;d=m.charCodeAt(w);M(true,-1)}else{if(ac){S("directives end mark is expected")}}f(r-1,CONTEXT_BLOCK_OUT,false,true);M(true,-1);if(V&&e&&PATTERN_NON_ASCII_LINE_BREAKS.test(m.slice(ab,w))){T("non-ASCII line breaks are interpreted as content")}v(K);if(w===s&&R()){if(CHAR_DOT===d){w+=3;d=m.charCodeAt(w);M(true,-1)}return}if(w<p){S("end of the stream or a document separator is expected")}else{return}}if(V&&PATTERN_NON_PRINTABLE.test(m)){S("the stream contains non-printable characters")}while(CHAR_SPACE===d){r+=1;d=m.charCodeAt(++w)}while(w<p){C()}}function load(b,c){var e=null,d=false;function a(f){if(!d){e=f;d=true}else{throw new YAMLException("expected a single document in the stream, but found more")}}loadAll(b,a,c);return e}function safeLoadAll(a,c,b){loadAll(a,c,common.extend({schema:SAFE_SCHEMA},b))}function safeLoad(a,b){return load(a,common.extend({schema:SAFE_SCHEMA},b))}module.exports.loadAll=loadAll;module.exports.load=load;module.exports.safeLoadAll=safeLoadAll;module.exports.safeLoad=safeLoad;