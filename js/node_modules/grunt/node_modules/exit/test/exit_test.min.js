"use strict";var fs=require("fs");var exec=require("child_process").exec;var _which=require("which").sync;function which(a){try{_which(a);return a}catch(b){return false}}var grep=which("grep")||process.platform==="win32"&&which("find");exports.exit={setUp:function(a){this.origCwd=process.cwd();process.chdir("test/fixtures");a()},tearDown:function(a){process.chdir(this.origCwd);a()},grep:function(a){a.expect(1);a.ok(grep,'A suitable "grep" or "find" program was not found in the PATH.');a.done()},};function normalizeLineEndings(a){return a.replace(/\r?\n/g,"\n")}function run(b,a){exec(b,function(c,d){a(c?c.code:0,normalizeLineEndings(d))})}function fixture(a){return normalizeLineEndings(String(fs.readFileSync(a)))}function buildTests(){var b=[10,100,1000];var c=[" stdout stderr"," stdout"," stderr"];var d=[""," | "+grep+' "std"'];b.forEach(function(e){c.forEach(function(f){d.forEach(function(h){var g="node log.js 0 "+e+f+" 2>&1"+h;exports.exit["output ("+g+")"]=function(i){i.expect(2);run(g,function(k,j){var l=fixture(e+f.replace(/ /g,"-")+".txt");i.equal(j.length,l.length,"should be the same length.");i.ok(j.indexOf("fail")===-1,"should not output after exit is called.");i.done()})}})})});var a=[0,1,123];a.forEach(function(e){var f="node log.js "+e+" 10 stdout stderr";exports.exit["exit code ("+f+")"]=function(g){g.expect(1);run(f,function(h){g.equal(h,e,"should exit with "+e+" error code.");g.done()})}})}if(grep){buildTests()};