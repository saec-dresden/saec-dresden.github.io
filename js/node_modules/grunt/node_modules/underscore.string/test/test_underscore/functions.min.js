$(document).ready(function(){module("Functions");test("functions: bind",function(){var c={name:"moe"};var e=function(f){return"name: "+(this.name||f)};var a=_.bind(e,c);equals(a(),"name: moe","can bind a function to a context");a=_(e).bind(c);equals(a(),"name: moe","can do OO-style binding");a=_.bind(e,null,"curly");equals(a(),"name: curly","can bind without specifying a context");e=function(g,f){return g+": "+f};e=_.bind(e,this,"hello");equals(e("moe"),"hello: moe","the function was partially applied in advance");var e=_.bind(e,this,"curly");equals(e(),"hello: curly","the function was completely applied in advance");var e=function(h,f,g){return h+": "+f+" "+g};e=_.bind(e,this,"hello","moe","curly");equals(e(),"hello: moe curly","the function was partially applied in advance and can accept multiple arguments");e=function(f,g){equals(this,f,g)};_.bind(e,0,0,"can bind a function to `0`")();_.bind(e,"","","can bind a function to an empty string")();_.bind(e,false,false,"can bind a function to `false`")();var d=function(){return this};var b=_.bind(d,{hello:"moe curly"});equal(new b().hello,undefined,"function should not be bound to the context, to comply with ECMAScript 5");equal(b().hello,"moe curly","When called without the new operator, it's OK to be bound to the context")});test("functions: bindAll",function(){var a={name:"curly"},b={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};a.getName=b.getName;_.bindAll(b,"getName","sayHi");a.sayHi=b.sayHi;equals(a.getName(),"name: curly","unbound function is bound to current object");equals(a.sayHi(),"hi: moe","bound function is still bound to original object");a={name:"curly"};b={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};_.bindAll(b);a.sayHi=b.sayHi;equals(a.sayHi(),"hi: moe","calling bindAll with no arguments binds all functions to the object")});test("functions: memoize",function(){var c=function(e){return e<2?e:c(e-1)+c(e-2)};var a=_.memoize(c);equals(c(10),55,"a memoized version of fibonacci produces identical results");equals(a(10),55,"a memoized version of fibonacci produces identical results");var d=function(e){return e};var b=_.memoize(d);equals(d("toString"),"toString","checks hasOwnProperty");equals(b("toString"),"toString","checks hasOwnProperty")});asyncTest("functions: delay",2,function(){var a=false;_.delay(function(){a=true},100);setTimeout(function(){ok(!a,"didn't delay the function quite yet")},50);setTimeout(function(){ok(a,"delayed the function");start()},150)});asyncTest("functions: defer",1,function(){var a=false;_.defer(function(b){a=b},true);_.delay(function(){ok(a,"deferred the function");start()},50)});asyncTest("functions: throttle",2,function(){var a=0;var b=function(){a++};var c=_.throttle(b,100);c();c();c();setTimeout(c,70);setTimeout(c,120);setTimeout(c,140);setTimeout(c,190);setTimeout(c,220);setTimeout(c,240);_.delay(function(){ok(a==1,"incr was called immediately")},30);_.delay(function(){ok(a==4,"incr was throttled");start()},400)});asyncTest("functions: throttle arguments",2,function(){var c=0;var b=function(d){c=d};var a=_.throttle(b,100);a(1);a(2);a(3);setTimeout(function(){a(4)},120);setTimeout(function(){a(5)},140);setTimeout(function(){a(6)},250);_.delay(function(){equals(c,1,"updated to latest value")},40);_.delay(function(){equals(c,6,"updated to latest value");start()},400)});asyncTest("functions: throttle once",1,function(){var a=0;var b=function(){a++};var c=_.throttle(b,100);c();_.delay(function(){ok(a==1,"incr was called once");start()},220)});asyncTest("functions: throttle twice",1,function(){var a=0;var b=function(){a++};var c=_.throttle(b,100);c();c();_.delay(function(){ok(a==2,"incr was called twice");start()},220)});asyncTest("functions: debounce",1,function(){var a=0;var c=function(){a++};var b=_.debounce(c,50);b();b();b();setTimeout(b,30);setTimeout(b,60);setTimeout(b,90);setTimeout(b,120);setTimeout(b,150);_.delay(function(){ok(a==1,"incr was debounced");start()},220)});test("functions: once",function(){var b=0;var a=_.once(function(){b++});a();a();equals(b,1)});test("functions: wrap",function(){var b=function(h){return"hi: "+h};var a=_.wrap(b,function(h,i){return h(i)+" "+i.split("").reverse().join("")});equals(a("moe"),"hi: moe eom","wrapped the saluation function");var c=function(){return"Hello "};var e={name:"Moe"};e.hi=_.wrap(c,function(h){return h()+this.name});equals(e.hi(),"Hello Moe");var d=function(){};var g=_.wrap(d,function(h){return Array.prototype.slice.call(arguments,0)});var f=g(["whats","your"],"vector","victor");same(f,[d,["whats","your"],"vector","victor"])});test("functions: compose",function(){var c=function(d){return"hi: "+d};var b=function(d){return d+"!"};var a=_.compose(b,c);equals(a("moe"),"hi: moe!","can compose a function that takes another");a=_.compose(c,b);equals(a("moe"),"hi: moe!","in this case, the functions are also commutative")});test("functions: after",function(){var a=function(c,e){var d=0;var b=_.after(c,function(){d++});while(e--){b()}return d};equals(a(5,5),1,"after(N) should fire after being called N times");equals(a(5,4),0,"after(N) should not fire unless called N times");equals(a(0,0),1,"after(0) should fire immediately")})});