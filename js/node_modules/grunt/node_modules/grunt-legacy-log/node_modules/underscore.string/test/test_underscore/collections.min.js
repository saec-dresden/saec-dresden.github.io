$(document).ready(function(){module("Collections");test("each",function(){_.each([1,2,3],function(d,c){equal(d,c+1,"each iterators provide value and iteration count")});var a=[];_.each([1,2,3],function(c){a.push(c*this.multiplier)},{multiplier:5});equal(a.join(", "),"5, 10, 15","context object property accessed");a=[];_.forEach([1,2,3],function(c){a.push(c)});equal(a.join(", "),"1, 2, 3",'aliased as "forEach"');a=[];var b={one:1,two:2,three:3};b.constructor.prototype.four=4;_.each(b,function(d,c){a.push(c)});equal(a.join(", "),"one, two, three","iterating over objects works, and ignores the object prototype.");delete b.constructor.prototype.four;answer=null;_.each([1,2,3],function(e,d,c){if(_.include(c,e)){answer=true}});ok(answer,"can reference the original collection from inside the iterator");a=0;_.each(null,function(){++a});equal(a,0,"handles a null properly")});test("map",function(){var a=_.map([1,2,3],function(e){return e*2});equal(a.join(", "),"2, 4, 6","doubled numbers");a=_.collect([1,2,3],function(e){return e*2});equal(a.join(", "),"2, 4, 6",'aliased as "collect"');var d=_.map([1,2,3],function(e){return e*this.multiplier},{multiplier:3});equal(d.join(", "),"3, 6, 9","tripled numbers with context");var a=_([1,2,3]).map(function(e){return e*2});equal(a.join(", "),"2, 4, 6","OO-style doubled numbers");if(document.querySelectorAll){var b=_.map(document.querySelectorAll("#map-test *"),function(e){return e.id});deepEqual(b,["id1","id2"],"Can use collection methods on NodeLists.")}var b=_.map($("#map-test").children(),function(e){return e.id});deepEqual(b,["id1","id2"],"Can use collection methods on jQuery Array-likes.");var b=_.map(document.images,function(e){return e.id});ok(b[0]=="chart_image","can use collection methods on HTMLCollections");var c=_.map(null,function(){});ok(_.isArray(c)&&c.length===0,"handles a null properly")});test("reduce",function(){var d=_.reduce([1,2,3],function(f,e){return f+e},0);equal(d,6,"can sum up an array");var a={multiplier:3};d=_.reduce([1,2,3],function(f,e){return f+e*this.multiplier},0,a);equal(d,18,"can reduce with a context object");d=_.inject([1,2,3],function(f,e){return f+e},0);equal(d,6,'aliased as "inject"');d=_([1,2,3]).reduce(function(f,e){return f+e},0);equal(d,6,"OO-style reduce");var d=_.reduce([1,2,3],function(f,e){return f+e});equal(d,6,"default initial value");var c;try{_.reduce(null,function(){})}catch(b){c=b}ok(c instanceof TypeError,"handles a null (without inital value) properly");ok(_.reduce(null,function(){},138)===138,"handles a null (with initial value) properly");equal(_.reduce([],function(){},undefined),undefined,"undefined can be passed as a special case");raises(function(){_.reduce([],function(){})},TypeError,"throws an error for empty arrays with no initial value")});test("reduceRight",function(){var f=_.reduceRight(["foo","bar","baz"],function(j,k){return j+k},"");equal(f,"bazbarfoo","can perform right folds");var f=_.foldr(["foo","bar","baz"],function(j,k){return j+k},"");equal(f,"bazbarfoo",'aliased as "foldr"');var f=_.foldr(["foo","bar","baz"],function(j,k){return j+k});equal(f,"bazbarfoo","default initial value");var d;try{_.reduceRight(null,function(){})}catch(b){d=b}ok(d instanceof TypeError,"handles a null (without inital value) properly");var i=_.reduceRight({a:1,b:2,c:3},function(k,j){return k+j});equal(i,6,"default initial value on object");ok(_.reduceRight(null,function(){},138)===138,"handles a null (with initial value) properly");equal(_.reduceRight([],function(){},undefined),undefined,"undefined can be passed as a special case");raises(function(){_.reduceRight([],function(){})},TypeError,"throws an error for empty arrays with no initial value");var a,g={},h={a:1,b:2},e=_.keys(h).pop();var c=e=="a"?[g,1,"a",h]:[g,2,"b",h];_.reduceRight(h,function(){a||(a=_.toArray(arguments))},g);deepEqual(a,c);h={"2":"a","1":"b"};e=_.keys(h).pop();a=null;c=e=="2"?[g,"a","2",h]:[g,"b","1",h];_.reduceRight(h,function(){a||(a=_.toArray(arguments))},g);deepEqual(a,c)});test("find",function(){var a=[1,2,3,4];strictEqual(_.find(a,function(b){return b>2}),3,"should return first found `value`");strictEqual(_.find(a,function(){return false}),void 0,"should return `undefined` if `value` is not found")});test("detect",function(){var a=_.detect([1,2,3],function(b){return b*2==4});equal(a,2,'found the first "2" and broke the loop')});test("select",function(){var a=_.select([1,2,3,4,5,6],function(b){return b%2==0});equal(a.join(", "),"2, 4, 6","selected each even number");a=_.filter([1,2,3,4,5,6],function(b){return b%2==0});equal(a.join(", "),"2, 4, 6",'aliased as "filter"')});test("reject",function(){var c=_.reject([1,2,3,4,5,6],function(d){return d%2==0});equal(c.join(", "),"1, 3, 5","rejected each even number");var a="obj";var b=_.reject([1,2,3,4,5,6],function(d){equal(a,"obj");return d%2!=0},a);equal(b.join(", "),"2, 4, 6","rejected each odd number")});test("all",function(){ok(_.all([],_.identity),"the empty set");ok(_.all([true,true,true],_.identity),"all true values");ok(!_.all([true,false,true],_.identity),"one false value");ok(_.all([0,10,28],function(a){return a%2==0}),"even numbers");ok(!_.all([0,11,28],function(a){return a%2==0}),"an odd number");ok(_.all([1],_.identity)===true,"cast to boolean - true");ok(_.all([0],_.identity)===false,"cast to boolean - false");ok(_.every([true,true,true],_.identity),'aliased as "every"');ok(!_.all([undefined,undefined,undefined],_.identity),"works with arrays of undefined")});test("any",function(){var a=Array.prototype.some;Array.prototype.some=null;ok(!_.any([]),"the empty set");ok(!_.any([false,false,false]),"all false values");ok(_.any([false,false,true]),"one true value");ok(_.any([null,0,"yes",false]),"a string");ok(!_.any([null,0,"",false]),"falsy values");ok(!_.any([1,11,29],function(b){return b%2==0}),"all odd numbers");ok(_.any([1,10,29],function(b){return b%2==0}),"an even number");ok(_.any([1],_.identity)===true,"cast to boolean - true");ok(_.any([0],_.identity)===false,"cast to boolean - false");ok(_.some([false,false,true]),'aliased as "some"');Array.prototype.some=a});test("include",function(){ok(_.include([1,2,3],2),"two is in the array");ok(!_.include([1,3,9],2),"two is not in the array");ok(_.contains({moe:1,larry:3,curly:9},3)===true,"_.include on objects checks their values");ok(_([1,2,3]).include(2),"OO-style include")});test("invoke",function(){var a=[[5,1,7],[3,2,1]];var b=_.invoke(a,"sort");equal(b[0].join(", "),"1, 5, 7","first array sorted");equal(b[1].join(", "),"1, 2, 3","second array sorted")});test("invoke w/ function reference",function(){var a=[[5,1,7],[3,2,1]];var b=_.invoke(a,Array.prototype.sort);equal(b[0].join(", "),"1, 5, 7","first array sorted");equal(b[1].join(", "),"1, 2, 3","second array sorted")});test("invoke when strings have a call method",function(){String.prototype.call=function(){return 42};var a=[[5,1,7],[3,2,1]];var c="foo";equal(c.call(),42,"call function exists");var b=_.invoke(a,"sort");equal(b[0].join(", "),"1, 5, 7","first array sorted");equal(b[1].join(", "),"1, 2, 3","second array sorted");delete String.prototype.call;equal(c.call,undefined,"call function removed")});test("pluck",function(){var a=[{name:"moe",age:30},{name:"curly",age:50}];equal(_.pluck(a,"name").join(", "),"moe, curly","pulls names out of objects")});test("where",function(){var a=[{a:1,b:2},{a:2,b:2},{a:1,b:3},{a:1,b:4}];var b=_.where(a,{a:1});equal(b.length,3);equal(b[b.length-1].b,4);b=_.where(a,{b:2});equal(b.length,2);equal(b[0].a,1)});test("max",function(){equal(3,_.max([1,2,3]),"can perform a regular Math.max");var a=_.max([1,2,3],function(b){return -b});equal(a,1,"can perform a computation-based max");equal(-Infinity,_.max({}),"Maximum value of an empty object");equal(-Infinity,_.max([]),"Maximum value of an empty array");equal(299999,_.max(_.range(1,300000)),"Maximum value of a too-big array")});test("min",function(){equal(1,_.min([1,2,3]),"can perform a regular Math.min");var a=_.min([1,2,3],function(d){return -d});equal(a,3,"can perform a computation-based min");equal(Infinity,_.min({}),"Minimum value of an empty object");equal(Infinity,_.min([]),"Minimum value of an empty array");var b=new Date(9999999999);var c=new Date(0);equal(_.min([b,c]),c);equal(1,_.min(_.range(1,300000)),"Minimum value of a too-big array")});test("sortBy",function(){var e=[{name:"curly",age:50},{name:"moe",age:30}];e=_.sortBy(e,function(g){return g.age});equal(_.pluck(e,"name").join(", "),"moe, curly","stooges sorted by age");var c=[undefined,4,1,undefined,3,2];equal(_.sortBy(c,_.identity).join(","),"1,2,3,4,,","sortBy with undefined values");var c=["one","two","three","four","five"];var f=_.sortBy(c,"length");equal(f.join(" "),"one two four five three","sorted by length");function d(g,h){this.x=g;this.y=h}var b=[new d(1,1),new d(1,2),new d(1,3),new d(1,4),new d(1,5),new d(1,6),new d(2,1),new d(2,2),new d(2,3),new d(2,4),new d(2,5),new d(2,6),new d(undefined,1),new d(undefined,2),new d(undefined,3),new d(undefined,4),new d(undefined,5),new d(undefined,6)];var a=_.sortBy(b,function(g){return g.x});deepEqual(a,b,"sortBy should be stable")});test("groupBy",function(){var e=_.groupBy([1,2,3,4,5,6],function(f){return f%2});ok("0" in e&&"1" in e,"created a group for each value");equal(e[0].join(", "),"2, 4, 6","put each even number in the right group");var d=["one","two","three","four","five","six","seven","eight","nine","ten"];var c=_.groupBy(d,"length");equal(c["3"].join(" "),"one two six ten");equal(c["4"].join(" "),"four five nine");equal(c["5"].join(" "),"three seven eight");var b={};_.groupBy([{}],function(){ok(this===b)},b);c=_.groupBy([4.2,6.1,6.4],function(f){return Math.floor(f)>4?"hasOwnProperty":"constructor"});equal(c.constructor.length,1);equal(c.hasOwnProperty.length,2);var a=[{}];_.groupBy(a,function(h,f,g){ok(g===a)})});test("countBy",function(){var e=_.countBy([1,2,3,4,5],function(f){return f%2==0});equal(e["true"],2);equal(e["false"],3);var d=["one","two","three","four","five","six","seven","eight","nine","ten"];var c=_.countBy(d,"length");equal(c["3"],4);equal(c["4"],3);equal(c["5"],3);var b={};_.countBy([{}],function(){ok(this===b)},b);c=_.countBy([4.2,6.1,6.4],function(f){return Math.floor(f)>4?"hasOwnProperty":"constructor"});equal(c.constructor,1);equal(c.hasOwnProperty,2);var a=[{}];_.countBy(a,function(h,f,g){ok(g===a)})});test("sortedIndex",function(){var f=[10,20,30,40,50],e=35;var c=_.sortedIndex(f,e);equal(c,3,"35 should be inserted at index 3");var b=_.sortedIndex(f,30);equal(b,2,"30 should be inserted at index 2");var g=[{x:10},{x:20},{x:30},{x:40}];var d=function(h){return h.x};strictEqual(_.sortedIndex(g,{x:25},d),2);strictEqual(_.sortedIndex(g,{x:35},"x"),3);var a={1:2,2:3,3:4};d=function(h){return this[h]};strictEqual(_.sortedIndex([1,3],2,d,a),1)});test("shuffle",function(){var a=_.range(10);var b=_.shuffle(a).sort();notStrictEqual(a,b,"original object is unmodified");equal(b.join(","),a.join(","),"contains the same members before and after shuffle")});test("toArray",function(){ok(!_.isArray(arguments),"arguments object is not an array");ok(_.isArray(_.toArray(arguments)),"arguments object converted into array");var b=[1,2,3];ok(_.toArray(b)!==b,"array is cloned");equal(_.toArray(b).join(", "),"1, 2, 3","cloned array contains same elements");var c=_.toArray({one:1,two:2,three:3});equal(c.join(", "),"1, 2, 3","object flattened into array")});test("size",function(){equal(_.size({one:1,two:2,three:3}),3,"can compute the size of an object");equal(_.size([1,2,3]),3,"can compute the size of an array");var a=function(){return _.size(arguments)};equal(a(1,2,3,4),4,"can test the size of the arguments object");equal(_.size("hello"),5,"can compute the size of a string");equal(_.size(null),0,"handles nulls")})});