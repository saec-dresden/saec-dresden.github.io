(function(){var d="unknown platform",j=navigator.userAgent;var c=["Windows","iPhone OS","(Intel |PPC )?Mac OS X","Linux"].join("|");var f=new RegExp("(("+c+") [^ );]*)").test(j)?RegExp.$1:null;if(!f){f=new RegExp("(("+c+")[^ );]*)").test(j)?RegExp.$1:null}var e=/(Chrome|MSIE|Safari|Opera|Firefox)/.test(j)?RegExp.$1:null;var k=new RegExp("(Version|"+e+")[ /]([^ ;]*)");var g=(e&&k.test(j))?RegExp.$2:null;var d=(f&&e&&g)?e+" "+g+" on "+f:"unknown platform";var a={escape:function(l){l=l.replace(/,/g,"\\,");l=escape(l);l=l.replace(/\+/g,"%2b");l=l.replace(/ /g,"+");return l},$:function(l){return document.getElementById(l)},F:function(){},status:function(m){var l=a.$("jsl_status");if(l){l.innerHTML=m||""}},toLabel:function(l){if(l==Infinity){return"Infinity"}else{if(l>1000000000){l=Math.round(l/100000000);return l/10+"B"}else{if(l>1000000){l=Math.round(l/100000);return l/10+"M"}else{if(l>1000){l=Math.round(l/100);return l/10+"K"}}}}return l},extend:function(l,n){for(var m in n){l[m]=n[m]}return l},join:function(p,l,m){if(p.join){return p.join(l)}var q=[];for(var n in p){q.push(n+l+p[n])}return q.join(m)},indexOf:function(l,n){if(l.indexOf){return l.indexOf(n)}for(var m=0;m<this.length;m++){if(l[m]===n){return m}}return -1}};var i=function(m,l){if(!l){throw new Error("Undefined test function")}if(!(/function[^\(]*\(([^,\)]*)/).test(l.toString())){throw new Error('"'+m+'" test: Test is not a valid Function object')}this.loopArg=RegExp.$1;this.name=m;this.f=l};a.extend(i,{CALIBRATIONS:[new i("calibrating loop",function(l){while(l--){}}),new i("calibrating function",a.F)],calibrate:function(n){for(var m=0;m<i.CALIBRATIONS.length;m++){var l=i.CALIBRATIONS[m];if(l.running){return true}if(!l.count){l.isCalibration=true;l.onStop=n;l.run(20000);return true}}return false}});a.extend(i.prototype,{INIT_COUNT:10,MAX_COUNT:1000000000,MIN_TIME:0.5,onChange:a.F,onStop:a.F,reset:function(){delete this.count;delete this.time;delete this.running;delete this.error},run:function(l){l=l||this.INIT_COUNT;a.status(this.name+" x "+l);this.running=true;var m=this;setTimeout(function(){m._run(l)},200)},_run:function(l){var p=this;if(!p.isCalibration&&i.calibrate(function(){p.run(l)})){return}this.error=null;try{var s,n=this.f,q,o=l;s=new Date();if(this.loopArg){n(l)}else{while(o--){n()}}this.time=Math.max(1,new Date()-s)/1000;this.count=l;this.period=this.time/l;this.running=this.time<=this.MIN_TIME;if(this.running){var t=this.MIN_TIME/this.time;var r=Math.pow(2,Math.max(1,Math.ceil(Math.log(t)/Math.log(2))));l*=r;if(l>this.MAX_COUNT){throw new Error("Max count exceeded.  If this test uses a looping function, make sure the iteration loop is working properly.")}}}catch(m){this.reset();this.error=m}if(this.running){p.run(l)}else{a.status("");p.onStop(p)}this.onChange(this)},getHz:function(m){var n=this.period;if(m&&!this.isCalibration){var l=i.CALIBRATIONS[this.loopArg?0:1];n=n<l.period*1.2?0:n-l.period}return Math.round(1/n)},toString:function(){return this.name+" - "+this.time/this.count+" secs"}});var h="<style>     #jslitmus {font-family:sans-serif; font-size: 12px;}     #jslitmus a {text-decoration: none;}     #jslitmus a:hover {text-decoration: underline;}     #jsl_status {       margin-top: 10px;       font-size: 10px;       color: #888;     }     A IMG  {border:none}     #test_results {       margin-top: 10px;       font-size: 12px;       font-family: sans-serif;       border-collapse: collapse;       border-spacing: 0px;     }     #test_results th, #test_results td {       border: solid 1px #ccc;       vertical-align: top;       padding: 3px;     }     #test_results th {       vertical-align: bottom;       background-color: #ccc;       padding: 1px;       font-size: 10px;     }     #test_results #test_platform {       color: #444;       text-align:center;     }     #test_results .test_row {       color: #006;       cursor: pointer;     }     #test_results .test_nonlooping {       border-left-style: dotted;       border-left-width: 2px;     }     #test_results .test_looping {       border-left-style: solid;       border-left-width: 2px;     }     #test_results .test_name {white-space: nowrap;}     #test_results .test_pending {     }     #test_results .test_running {       font-style: italic;     }     #test_results .test_done {}     #test_results .test_done {       text-align: right;       font-family: monospace;     }     #test_results .test_error {color: #600;}     #test_results .test_error .error_head {font-weight:bold;}     #test_results .test_error .error_body {font-size:85%;}     #test_results .test_row:hover td {       background-color: #ffc;       text-decoration: underline;     }     #chart {       margin: 10px 0px;       width: 250px;     }     #chart img {       border: solid 1px #ccc;       margin-bottom: 5px;     }     #chart #tiny_url {       height: 40px;       width: 250px;     }     #jslitmus_credit {       font-size: 10px;       color: #888;       margin-top: 8px;     }     </style>";var b='<div id="jslitmus">       <button onclick="JSLitmus.runAll(event)">Run Tests</button>       <button id="stop_button" disabled="disabled" onclick="JSLitmus.stop()">Stop Tests</button>       <br >       <br >       <input type="checkbox" style="vertical-align: middle" id="test_normalize" checked="checked" onchange="JSLitmus.renderAll()""> Normalize results       <table id="test_results">         <colgroup>           <col />           <col width="100" />         </colgroup>         <tr><th id="test_platform" colspan="2">'+d+'</th></tr>         <tr><th>Test</th><th>Ops/sec</th></tr>         <tr id="test_row_template" class="test_row" style="display:none">           <td class="test_name"></td>           <td class="test_result">Ready</td>         </tr>       </table>       <div id="jsl_status"></div>       <div id="chart" style="display:none">       <a id="chart_link" target="_blank"><img id="chart_image"></a>       TinyURL (for chart):       <iframe id="tiny_url" frameBorder="0" scrolling="no" src=""></iframe>       </div>       <a id="jslitmus_credit" title="JSLitmus home page" href="http://code.google.com/p/jslitmus" target="_blank">Powered by JSLitmus</a>     </div>';window.JSLitmus={_tests:[],_queue:[],params:{},_init:function(){var n=(location+"").match(/([^?#]*)(#.*)?$/);if(n){var p=n[1].split("&");for(var l=0;l<p.length;l++){var o=p[l].split("=");if(o.length>1){var m=o.shift();var q=o.length>1?o.join("="):o[0];this.params[m]=q}}}document.write(h);if(window.addEventListener){window.addEventListener("load",this._setup,false)}else{if(document.addEventListener){document.addEventListener("load",this._setup,false)}else{if(window.attachEvent){window.attachEvent("onload",this._setup)}}}return this},_setup:function(){var l=a.$("jslitmus_container");if(!l){document.body.appendChild(l=document.createElement("div"))}l.innerHTML=b;for(var m=0;m<JSLitmus._tests.length;m++){JSLitmus.renderTest(JSLitmus._tests[m])}},renderAll:function(){for(var l=0;l<JSLitmus._tests.length;l++){JSLitmus.renderTest(JSLitmus._tests[l])}JSLitmus.renderChart()},renderChart:function(){var l=JSLitmus.chartUrl();a.$("chart_link").href=l;a.$("chart_image").src=l;a.$("chart").style.display="";a.$("tiny_url").src="http://tinyurl.com/api-create.php?url="+escape(l)},renderTest:function(o){if(!o._row){var p=a.$("test_row_template");if(!p){return}o._row=p.cloneNode(true);o._row.style.display="";o._row.id="";o._row.onclick=function(){JSLitmus._queueTest(o)};o._row.title="Run "+o.name+" test";p.parentNode.appendChild(o._row);o._row.cells[0].innerHTML=o.name}var l=o._row.cells[1];var m=[o.loopArg?"test_looping":"test_nonlooping"];if(o.error){m.push("test_error");l.innerHTML='<div class="error_head">'+o.error+'</div><ul class="error_body"><li>'+a.join(o.error,": ","</li><li>")+"</li></ul>"}else{if(o.running){m.push("test_running");l.innerHTML="running"}else{if(a.indexOf(JSLitmus._queue,o)>=0){m.push("test_pending");l.innerHTML="pending"}else{if(o.count){m.push("test_done");var n=o.getHz(a.$("test_normalize").checked);l.innerHTML=n!=Infinity?n:"&infin;"}else{l.innerHTML="ready"}}}}l.className=m.join(" ")},test:function(m,l){var n=new i(m,l);JSLitmus._tests.push(n);n.onChange=JSLitmus.renderTest;n.onStop=function(o){if(JSLitmus.onTestFinish){JSLitmus.onTestFinish(o)}JSLitmus.currentTest=null;JSLitmus._nextTest()};this.renderTest(n)},runAll:function(l){l=l||window.event;var o=l&&l.shiftKey,n=JSLitmus._tests.length;for(var m=0;m<n;m++){JSLitmus._queueTest(JSLitmus._tests[!o?m:(n-m-1)])}},stop:function(){while(JSLitmus._queue.length){var l=JSLitmus._queue.shift();JSLitmus.renderTest(l)}},_nextTest:function(){if(!JSLitmus.currentTest){var l=JSLitmus._queue.shift();if(l){a.$("stop_button").disabled=false;JSLitmus.currentTest=l;l.run();JSLitmus.renderTest(l);if(JSLitmus.onTestStart){JSLitmus.onTestStart(l)}}else{a.$("stop_button").disabled=true;JSLitmus.renderChart()}}},_queueTest:function(l){if(a.indexOf(JSLitmus._queue,l)>=0){return}JSLitmus._queue.push(l);JSLitmus.renderTest(l);JSLitmus._nextTest()},chartUrl:function(){var A=JSLitmus._tests.length,x=[],q=[];var p,z=0,y=-10000000000;var B=a.$("test_normalize").checked;for(var t=0;t<JSLitmus._tests.length;t++){var D=JSLitmus._tests[t];if(D.count){var s=D.getHz(B);var F=s!=Infinity?s:0;q.push(F);x.push("t"+a.escape(D.name+"("+a.toLabel(s)+")")+",000000,0,"+x.length+",10");y=Math.max(F,y)}}if(x.length<=0){return null}var E=document.getElementsByTagName("title");E=(E&&E.length)?E[0].innerHTML:null;var o=[];if(E){o.push(E)}o.push("Ops/sec ("+d+")");var u=[a.toLabel(z),a.toLabel(y)];var G=250,m=15;var l=5;var r=x.length*(m+l)+30+o.length*20;var C={chtt:escape(o.join("|")),chts:"000000,10",cht:"bhg",chd:"t:"+q.join(","),chds:z+","+y,chxt:"x",chxl:"0:|"+u.join("|"),chsp:"0,1",chm:x.join("|"),chbh:[m,0,l].join(","),chs:G+"x"+r};return"http://chart.apis.google.com/chart?"+a.join(C,"=","&")}};JSLitmus._init()})();